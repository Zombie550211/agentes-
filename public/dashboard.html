<!DOCTYPE html>
<html lang="es">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>CRM Agente</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-minimal/minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="css/dashboard.css">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/modern-lead-form.css?v=1.1">
  <link rel="stylesheet" href="css/modern-form-styles.css">
  <!-- jQuery y jQuery Modal -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />

  <style>
    /* --- ESTILO PARA BOTÃ“N DE COMENTARIOS --- */
    .comentarios-btn {
      background: #e3f2fd;
      border: 1px solid #bbdefb;
      border-radius: 16px;
      color: #1976d2;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 4px 12px;
      font-size: 0.85em;
      transition: all 0.2s ease;
      position: relative;
    }
    
    .comentarios-btn:hover {
      background: #bbdefb;
      transform: translateY(-1px);
    }
    
    .comentarios-btn .comment-count {
      background: #1976d2;
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7em;
      margin-left: 4px;
      font-weight: bold;
    }
    
    .comentarios-btn.has-comments {
      background: #e3f2fd;
      border: 1px solid #64b5f6;
      box-shadow: 0 1px 3px rgba(25, 118, 210, 0.2);
    }
    
    .comentarios-btn i {
      font-size: 0.9em;
    }
    
    /* --- ESTILO FORZADO PARA TABLA DE CLIENTES --- */
    div.costumer-table-container, .costumer-table-container {
      width: 100% !important;
      flex-grow: 1; /* Permite que el contenedor de la tabla crezca */
      overflow-y: auto !important; /* Mantiene el scroll vertical */
      overflow-x: auto !important;
      background: #fff !important;
      padding: 0 !important;
      margin-bottom: 24px !important;
      border-radius: 18px 18px 0 0 !important;
      box-shadow: 0 6px 28px #1976d220 !important;
    }
    table.costumer-table-elegant, .costumer-table-elegant {
      width: 100% !important;
      border-collapse: separate !important;
      border-spacing: 0 !important;
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif !important;
      color: #0a2540 !important;
      font-size: 1.08em !important;
      background: #fff !important;
      border-radius: 18px 18px 0 0 !important;
      overflow: hidden !important;
    }
    .costumer-table-elegant thead th {
      position: sticky !important;
      top: 0 !important;
      z-index: 10 !important;
      background: #f8fafc !important;
      color: #475569 !important; /* Tono de gris más suave */
      font-weight: 600 !important; /* Un poco más de grosor */
      padding: 12px 15px !important;
      text-align: left !important;
      border: none !important;
      border-bottom: 1px solid #e2e8f0 !important; /* Borde más sutil */
      font-size: 0.75em !important;
      text-transform: uppercase !important;
      letter-spacing: 0.05em !important; /* Más espaciado */
    }
    .costumer-table-elegant tbody tr {
      border: none !important;
      border-bottom: 1px solid #f1f5f9 !important; /* Borde sutil para separar filas */
      background: #fff !important;
      transition: background-color 0.2s ease !important;
    }
    /* Se elimina el color de fondo alterno para un look más limpio */
    .costumer-table-elegant tbody tr:nth-child(even) {
      background-color: #fff !important;
    }
    .costumer-table-elegant tbody tr:hover {
      background-color: #f1f5ff !important;
    }
    .costumer-table-elegant td {
      padding: 8px 15px !important; /* Espaciado vertical reducido */
      vertical-align: middle !important;
      border: none !important;
      font-size: 0.9em !important; /* Tamaño de fuente consistente */
      color: #334155 !important; /* Color de texto más suave */
      background: transparent !important;
      font-weight: 300 !important;
    }
    .costumer-table-elegant .badge-status {
      display: inline-block !important;
      padding: 5px 18px !important;
      border-radius: 16px !important;
      font-size: 1em !important;
      font-weight: 700 !important;
      background: #e3eaf5 !important;
      color: #1976d2 !important;
      border: none !important;
      letter-spacing: 0.04em !important;
      box-shadow: 0 1px 2px #1976d208 !important;
    }
    .costumer-table-elegant .badge-status-activo {
      background: #c8f7d8 !important;
      color: #219653 !important;
    }
    .costumer-table-elegant .badge-status-pendiente {
      background: #fff7e0 !important;
      color: #f2994a !important;
    }
    .costumer-table-elegant .badge-status-cancelado {
      background: #ffeaea !important;
      color: #e74c3c !important;
    }
    .costumer-table-elegant .badge-status-inactivo {
      background: #f3f3f3 !important;
      color: #bdbdbd !important;
    }
    .costumer-table-elegant .actions-cell {
      white-space: nowrap !important;
      text-align: right !important;
      padding-right: 8px !important;
    }
    .costumer-table-elegant .action-btn {
      background: none !important;
      border: 1px solid #e2e8f0 !important;
      color: #64748b !important;
      cursor: pointer !important;
      padding: 6px 10px !important;
      border-radius: 6px !important;
      margin: 0 2px !important;
      transition: all 0.15s ease !important;
      font-size: 0.9em !important;
      width: 32px !important;
      height: 32px !important;
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
    }
    .costumer-table-elegant .action-btn:hover {
      background-color: #f1f5ff !important;
      color: #1976d2 !important;
      transform: translateY(-1px) !important;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;
    }
    .costumer-table-elegant .action-btn.delete-btn:hover {
      color: #dc2626 !important;
      background-color: #fef2f2 !important;
      border-color: #fecaca !important;
    }
    .costumer-table-elegant .comentario-item {
      padding: 10px 0 !important;
      border-bottom: 1px solid #f0f0f0 !important;
      margin-bottom: 7px !important;
    }
    .costumer-table-elegant .comentario-item:last-child {
      border-bottom: none !important;
    }
    .costumer-table-elegant .comentario-meta {
      color: #1976d2 !important;
      font-size: 0.97em !important;
      margin-bottom: 2px !important;
      font-weight: 700 !important;
    }
    /* --- FIN ESTILO FORZADO --- */

    /* --- Estilo para scroll en panel de gráficas --- */
    #charts-panel {
      max-height: calc(100vh - 100px); /* Ajusta 100px a la altura de tu cabecera y otros elementos */
      overflow-y: auto;
      padding-right: 15px; /* Espacio para la barra de scroll */
    }

    /* --- Layout para llenar espacio vertical --- */
    .main-content {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 60px); /* Ajusta 60px a la altura de tu cabecera */
    }
    #costumerTab {
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      overflow: hidden; /* Previene doble scroll */
    }
    .costumer-table-container {
      width: 100%;
      overflow-x: auto;
      background: #fff;
      padding: 0;
      margin-bottom: 24px;
      border-radius: 14px 14px 0 0;
      box-shadow: 0 4px 24px #0001;
    }
    .costumer-table-elegant {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      color: #24334d;
      font-size: 1em;
      background: #fff;
      border-radius: 14px 14px 0 0;
      overflow: hidden;
    }
    .costumer-table-elegant thead th {
      position: sticky;
      top: 0;
      z-index: 10;
      background: #fff;
      color: #1976d2;
      font-weight: 700;
      padding: 17px 13px 15px 13px;
      text-align: left;
      border: none;
      border-bottom: 2px solid #e3eaf5;
      font-size: 1em;
      letter-spacing: 0.01em;
    }
    .costumer-table-elegant tbody tr {
      border: none;
      border-bottom: 1.5px solid #f0f3fa;
      background: #fff;
      transition: background 0.18s;
    }
    .costumer-table-elegant tbody tr:nth-child(even) {
      background: #f7fafd;
    }
    .costumer-table-elegant tbody tr:hover {
      background: #e3f0fd !important;
    }
    .costumer-table-elegant td {
      padding: 14px 16px !important;
      vertical-align: middle !important;
      color: #334155 !important;
      font-size: 0.92em !important;
      border: none !important;
      border-bottom: 1px solid #f1f5f9 !important;
      line-height: 1.4 !important;
    }
    .costumer-table-elegant .badge-status {
      display: inline-block;
      padding: 3px 14px;
      border-radius: 12px;
      font-size: 0.87em;
      font-weight: 600;
      background: #e3eaf5;
      color: #1976d2;
      letter-spacing: 0.03em;
      border: none;
    }
    .costumer-table-elegant .badge-status-activo {
      background: #e5f9ea;
      color: #219653;
    }
    .costumer-table-elegant .badge-status-pendiente {
      background: #fff7e0;
      color: #f2994a;
    }
    .costumer-table-elegant .badge-status-cancelado {
      background: #ffeaea;
      color: #e74c3c;
    }
    .costumer-table-elegant .badge-status-inactivo {
      background: #f3f3f3;
      color: #bdbdbd;
    }
    .costumer-table-elegant .costumer-action-btn {
      background: none;
      border: none;
      padding: 5px;
      margin: 0 2px;
      cursor: pointer;
      font-size: 1.1em;
      color: #b0b8c1;
      border-radius: 50%;
      transition: background 0.18s, color 0.18s;
    }
    .costumer-table-elegant .costumer-action-btn:hover {
      background: #e3eaf5;
      color: #1976d2;
    }
    .costumer-table-elegant .comentario-item {
      padding: 7px 0;
      border-bottom: 1px solid #f0f0f0;
      margin-bottom: 5px;
    }
    .costumer-table-elegant .comentario-item:last-child {
      border-bottom: none;
    }
    .costumer-table-elegant .comentario-meta {
      color: #1976d2;
      font-size: 0.88em;
      margin-bottom: 2px;
      font-weight: 500;
    }
    /* --- FIN ESTILO NOTORIO --- */

    /* Contenedor principal de la tabla */
    .costumer-table-container {
      width: 100%;
      overflow-x: auto;
      background: white;
      padding: 0;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
    }

    /* Tabla principal */
    .costumer-table-elegant {
      width: 100%;
      border-collapse: collapse;
      border-spacing: 0;
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      color: #333;
      font-size: 0.95em;
    }

    /* Cabecera de la tabla */
    .costumer-table-elegant thead th {
      position: sticky;
      top: 0;
      z-index: 10;
      background-color: #ffffff;
      color: #555;
      font-weight: 600;
      padding: 15px 12px;
      text-align: left;
      border: none;
      border-bottom: 1px solid #eaeaea;
      font-size: 0.9em;
      letter-spacing: 0.02em;
    }

    /* Filas del cuerpo de la tabla */
    .costumer-table-elegant tbody tr {
      border: none;
      border-bottom: 1px solid #f0f0f0;
      transition: background-color 0.15s ease;
    }

    /* Ãšltima fila sin borde inferior */
    .costumer-table-elegant tbody tr:last-child {
      border-bottom: none;
    }

    /* Hover sutil en las filas */
    .costumer-table-elegant tbody tr:hover {
      background-color: #f9fbfd;
    }

    /* Celdas de la tabla */
    .costumer-table-elegant td {
      padding: 12px;
      vertical-align: middle;
      border: none;
    }

    /* Badges de estado con diseño minimalista */
    .costumer-table-elegant .badge-status {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 0.85em;
      font-weight: 500;
      background: #f5f5f5;
      color: #555;
    }

    /* Estilos específicos para cada tipo de estado */
    .costumer-table-elegant .badge-status-activo {
      background-color: #e8f5e9;
      color: #2e7d32;
    }

    .costumer-table-elegant .badge-status-pendiente {
      background-color: #fff8e1;
      color: #f57c00;
    }

    .costumer-table-elegant .badge-status-cancelado {
      background-color: #ffebee;
      color: #c62828;
    }

    .costumer-table-elegant .badge-status-inactivo {
      background-color: #f5f5f5;
      color: #757575;
    }

    /* Tooltips minimalistas */
    .costumer-table-elegant .comentario-tooltip-minimal::after {
      content: attr(data-tooltip);
      position: absolute;
      left: 50%;
      top: 130%;
      transform: translateX(-50%);
      background: white;
      color: #333;
      border: 1px solid #eaeaea;
      border-radius: 4px;
      padding: 8px 12px;
      font-size: 0.9em;
      z-index: 20;
      min-width: 180px;
      max-width: 300px;
      pointer-events: none;
      white-space: pre-line;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .costumer-table-elegant .comentario-tooltip-minimal:hover::after {
      opacity: 1;
      visibility: visible;
      top: 120%;
    }

    /* Botones de acción minimalistas */
    .costumer-table-elegant .costumer-action-btn {
      background: none;
      border: none;
      padding: 6px;
      margin: 0 3px;
      cursor: pointer;
      font-size: 1em;
      color: #777;
      transition: color 0.15s ease;
    }

    .costumer-table-elegant .costumer-action-btn.edit:hover {
      color: #1976d2;
    }

    .costumer-table-elegant .costumer-action-btn.delete:hover {
      color: #e53935;
    }

    /* Panel de comentarios con estilo minimalista */
    .costumer-table-elegant .comentarios-panel {
      background: white;
      border-top: 1px solid #f0f0f0;
      padding: 15px 20px;
      margin: 0;
    }

    .costumer-table-elegant .comentario-item {
      padding: 8px 0;
      border-bottom: 1px solid #f0f0f0;
      margin-bottom: 6px;
    }

    .costumer-table-elegant .comentario-item:last-child {
      border-bottom: none;
    }

    .costumer-table-elegant .comentario-meta {
      color: #777;
      font-size: 0.85em;
      margin-bottom: 3px;
    }

    /* Formulario de nuevo comentario */
    .costumer-table-elegant .nuevo-comentario-form textarea {
      width: 100%;
      border: 1px solid #eaeaea;
      border-radius: 4px;
      padding: 8px 10px;
      font-size: 0.95em;
      resize: vertical;
      min-height: 60px;
      transition: border-color 0.15s ease;
    }

    .costumer-table-elegant .nuevo-comentario-form textarea:focus {
      border-color: #bbb;
      outline: none;
    }

    .costumer-table-elegant .nuevo-comentario-form button {
      background-color: #f5f5f5;
      color: #555;
      border: 1px solid #eaeaea;
      border-radius: 4px;
      padding: 6px 12px;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.15s ease;
      margin-top: 8px;
    }

    .costumer-table-elegant .nuevo-comentario-form button:hover {
      background-color: #e0e0e0;
    }

    :root {
      --primary: #4a90e2;
      --accent: #5c9ce6;
      --light: #e8f1fa;
      --dark: #2c5282;
      --text-color: #4a5568;
      --border-color: #e2e8f0;
      --background-color: #f7fafc;
      --text-main: #24334d;
      --gray-light: #f8fbff;
      --sidebar-bg: linear-gradient(145deg, #ffffff 0%, #f8fbff 100%);
      --sidebar-shadow: 0 8px 32px rgba(74, 144, 226, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08);
      --sidebar-hover: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      --sidebar-active: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
      --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --border-radius: 16px;
      --card-shadow: 0 4px 20px #0002, 0 1.5px 3px #19b6f922;
    }
    html, body {height:100%;margin:0;padding:0;}
    body {
      background: var(--background-color);
      font-family:'Segoe UI', 'Roboto', 'Montserrat', Arial, sans-serif;
      min-height:100vh;
      color: var(--text-color);
      height: 100vh;
      overflow: hidden; padding-bottom: 32px;
  margin-bottom: 20px;
    }
    .topbar {
      background: linear-gradient(135deg, var(--primary) 0%, #1565c0 50%, #0d47a1 100%);
      color: #fff;
      padding: 1.2em 2.5em;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.11em;
      font-weight: 600;
      letter-spacing: 0.02em;
      box-shadow: 0 4px 20px rgba(33, 150, 243, 0.25), 0 2px 8px rgba(0, 0, 0, 0.1);
      position: relative;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .topbar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%, rgba(0, 0, 0, 0.05) 100%);
      pointer-events: none;
    }
    
    .topbar > div {
      position: relative;
      z-index: 1;
    }
    
    .topbar .fas.fa-user-tie {
      background: linear-gradient(135deg, #fff 0%, #e3f2fd 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    }
    
    .topbar b {
      background: linear-gradient(135deg, #fff 0%, #e3f2fd 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 1.1em;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .topbar a.logout {
      color: #fff !important;
      font-weight: 700;
      text-decoration: none;
      transition: var(--transition-smooth);
      border: 2px solid rgba(255, 255, 255, 0.2);
      padding: 0.6em 1.2em;
      border-radius: 12px;
      backdrop-filter: blur(5px);
      background: rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .topbar a.logout::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.2) 50%, transparent 100%);
      transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .topbar a.logout:hover::before {
      left: 100%;
    }
    
    .topbar a.logout:hover {
      color: #fff !important;
      border-color: rgba(255, 255, 255, 0.4);
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15), 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    
    .topbar a.logout i {
      transition: var(--transition-smooth);
    }
    
    .topbar a.logout:hover i {
      transform: scale(1.1) rotate(-5deg);
    }
    .container {
      display: flex;
      align-items: flex-start;
      width: 100vw;
      height: calc(100vh - 56px);
      min-height: 0;
  margin-bottom: 20px;
}
.sidebar {
  width: var(--sidebar-width);
  background: var(--sidebar-bg);
  border-radius: var(--sidebar-border-radius);
  box-shadow: var(--sidebar-shadow);
  padding: 2em 0.8em 2em 2em;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  font-size: 1.09em;
  font-weight: 500;
  z-index: 3;
  min-height: 0;
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(10px);
}
  
.sidebar::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--sidebar-bg);
  z-index: -1;
}
.sidebar h3 {
  font-size: 1.14em;
  margin-bottom: 1.5em;
  font-weight: 700;
  color: var(--primary);
  letter-spacing: 0.04em;
}
.sidebar ul {
  list-style: none;
  padding: 0;
  width: 100%;
}
.sidebar li {margin: 1.2em 0;}
.sidebar a {
  color: var(--primary);
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 0.9em 1.4em;
  border-radius: 16px;
  transition: var(--transition-smooth);
  font-weight: 600;
  width: 100%;
  box-sizing: border-box;
  letter-spacing: 0.03em;
  position: relative;
  overflow: hidden;
  border-left: 3px solid transparent;
}

.sidebar a::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent 0%, rgba(33, 150, 243, 0.1) 50%, transparent 100%);
  transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.sidebar a:hover::before {
  left: 100%;
}

.sidebar a:hover {
  background: var(--sidebar-hover);
  color: var(--primary);
  border-left: 4px solid var(--accent);
  transform: translateX(8px) scale(1.02);
  box-shadow: 0 8px 25px rgba(33, 150, 243, 0.15), 0 3px 10px rgba(0, 0, 0, 0.05);
}

.sidebar a.active, .sidebar a:focus {
  background: linear-gradient(135deg, rgba(33, 150, 243, 0.12) 0%, rgba(33, 150, 243, 0.08) 100%);
  color: var(--primary);
  border-left: 4px solid var(--accent);
  box-shadow: 0 6px 20px rgba(33, 150, 243, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.2);
  transform: translateX(4px);
}

.sidebar a i {
  font-size: 1.1em;
  transition: var(--transition-smooth);
  min-width: 20px;
}

.sidebar a:hover i {
  transform: scale(1.15) rotate(5deg);
  color: var(--accent);
}

.sidebar a.active i {
  color: var(--accent);
  transform: scale(1.1);
}
.main-content {
  flex: 1;
  min-width: 0;
  height: 100%;
  padding: 0 0 0 0.6em;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  min-height: 0;
  overflow: hidden; padding-bottom: 32px;
      color: var(--primary);
      letter-spacing: 0.04em;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      width: 100%;
    }
    .sidebar li {margin: 1.2em 0;}
    .sidebar a {
      color: var(--primary);
      text-decoration: none;
      display: block;
      padding: 0.7em 1.2em;
      border-radius: 10px;
      transition: background 0.22s, color 0.22s, border-left 0.18s;
      font-weight: 700;
      width: 100%;
      box-sizing: border-box;
      letter-spacing: 0.03em;
    }
    .sidebar a.active, .sidebar a:focus {
      background: linear-gradient(90deg, #e3f2fd 0%, #e8f5ff 100%);
      color: var(--primary);
      border-left: 5px solid var(--accent);
      box-shadow:0 2px 8px #2196f922;
    }
    .main-content {
      flex: 1;
      min-width: 0;
      height: 100%;
      padding: 0 0 0 0.6em;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      min-height: 0;
      overflow: hidden; padding-bottom: 32px;
  margin-bottom: 20px;
    }
    .dashboard-flex-row {
      display: flex;
      flex-direction: row;
      gap: 2.5em;
      height: 100%;
      min-height: 0;
      align-items: flex-start;
    }

    .crm-form-section {
      max-width: 510px;
      width: 100%;
      align-self: flex-start;
      padding: 0;
      height: 100%;
      overflow-y: auto;
      scrollbar-width: thin;
    }
    .charts-section {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 1.5em;
      height: 100%;
    }
    .charts-filter {
      margin-bottom: 18px;
      padding: 13px 24px;
      background: #f8fbff;
      border-radius: 11px;
      border: 1px solid #e2e8f0;
      display: flex;
      align-items: center;
      gap: 18px;
      box-shadow: 0 2px 10px #2196f911;
    }
    .charts-filter label { font-weight: 700; margin-bottom: 0; color: var(--primary-dark);}
    .charts-filter input[type="date"] { padding: 8px 13px; border-radius: 8px; border: 1px solid #b4c5d4; font-size:1em;}
    .charts-filter button {
      background: var(--primary) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round' class='feather feather-bar-chart-2'%3E%3Cline x1='18' y1='20' x2='18' y2='10'/%3E%3Cline x1='12' y1='20' x2='12' y2='4'/%3E%3Cline x1='6' y1='20' x2='6' y2='14'/%3E%3C/svg%3E") no-repeat center center;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0;
      width: 38px;
      height: 38px;
      font-size: 0;
      cursor: pointer;
      transition: background .2s;
    }
    .charts-filter button:hover { background: var(--primary-dark); }
    .chart-container {
  min-height: 320px;
  padding: 10px 12px;
      background: #fff;
      padding: 22px 28px;
      border: 1px solid #e2e8f0;
      border-radius: 13px;
      box-shadow: 0 2px 10px #2196f911;
      flex: 1;
    }
    .no-data-msg { color: #d32f2f; font-weight: bold; text-align: center; margin-top: 10px;}
    .costumer-section { width: 100%; }
    .costumer-filters-elegant {
      background: #f8fbff;
      border-radius: 14px;
      border: 1.5px solid #e2e8f0;
      margin-bottom: 18px;
      box-shadow: 0 2px 8px #1976d211;
      padding: 18px 22px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px 20px;
    }
    .costumer-filter-input {
      padding: 10px 14px;
      border-radius: 9px;
      border: 1.5px solid #b4c5d4;
      font-size: 1.02em;
    }
    .costumer-btn-elegant {
      padding: 10px 22px;
      background: linear-gradient(90deg,#1976d2 60%,#2196f3 100%);
      color: #fff;
      border: none;
  font-size: 1.10em;
  border: none;
  border-radius: 999px !important;
  padding: 1.1em 1.5em;
  margin: 0 0.25em;
  box-shadow: 0 2px 10px #1976d222, 0 1.5px 6px #2196f911;
  letter-spacing: 0.01em;
  transition: background 0.18s, color 0.18s, box-shadow 0.18s;
  font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
}
.costumer-table-elegant {
  border-collapse: separate;
  border-spacing: 0;
  width: 100%;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 16px #1976d211;
  overflow: hidden; padding-bottom: 32px;
  margin-bottom: 20px;
}
.costumer-table-elegant thead th {
  position: sticky;
  top: 0;
  z-index: 2;
  background: linear-gradient(90deg, #1976d2 60%, #2196f3 100%);
  color: #fff;
  font-weight: 700;
  font-size: 1.08em;
  letter-spacing: 0.04em;
  border: none;
  padding: 13px 8px;
  text-align: left;
}
.costumer-table-elegant tbody tr {
  transition: background 0.18s;
  border: none;
}
.costumer-table-elegant tbody tr:nth-child(even) {
  background: #f8fbff;
}
.costumer-table-elegant tbody tr:hover {
  background: #e3f2fd !important;
}
.costumer-table-elegant td {
  border: none;
  padding: 11px 8px;
  font-size: 1.01em;
  color: #24334d;
  vertical-align: middle;
  word-break: break-word;
  max-width: 270px;
}
.costumer-table-elegant td.comentario {
  position: relative;
  cursor: pointer;
}
.costumer-table-elegant td.comentario:hover::after {
  content: attr(data-tooltip);
  position: absolute;
  left: 50%;
  top: 120%;
  transform: translateX(-50%);
  background: #fff;
  color: #24334d;
  border: 1px solid #b4c5d4;
  border-radius: 7px;
  padding: 10px 17px;
  box-shadow: 0 4px 16px #1976d211;
  font-size: 0.98em;
  z-index: 20;
  min-width: 180px;
  max-width: 350px;
  pointer-events: none;
  white-space: pre-line;
}
.costumer-table-elegant td, .costumer-table-elegant th {
  border-radius: 0 !important;
}
.costumer-table-elegant thead th:first-child {
  border-top-left-radius: 16px;
}
.costumer-table-elegant thead th:last-child {
  border-top-right-radius: 16px;
}
.costumer-table-elegant tbody tr:last-child td:first-child {
  border-bottom-left-radius: 16px;
}
.costumer-table-elegant tbody tr:last-child td:last-child {
  border-bottom-right-radius: 16px;
}
.costumer-table-elegant .agrupador-dia {
  background: #e3f2fd;
  font-weight: bold;
  color: #1976d2;
  font-size: 1.04em;
  letter-spacing: 0.03em;
  border-top: 2px solid #b4c5d4;
  border-bottom: 2px solid #b4c5d4;
}

.costumer-table-elegant .comentario-btn-minimal, .costumer-table-elegant .acciones-btn-minimal {
  background: none; border: none; color: #1976d2; font-size: 1.05em; padding: 5px 7px; border-radius: 7px;
  transition: background 0.18s, color 0.18s;
  margin-right: 3px;
  cursor: pointer;
}
.costumer-table-elegant .comentario-btn-minimal:hover, .costumer-table-elegant .acciones-btn-minimal:hover { background: #e3f2fd; color: #0d47a1; }
.costumer-table-elegant .acciones-btn-minimal.borrar { color: #e53935; }
.costumer-table-elegant .acciones-btn-minimal.borrar:hover { background: #ffebee; color: #b71c1c; }
.costumer-table-elegant .comentario-tooltip-minimal { margin-left:5px; color:#1976d2; cursor:pointer; position:relative; }
.costumer-table-elegant .comentario-tooltip-minimal:hover::after {
  content: attr(data-tooltip);
  white-space: pre-line;
  position: absolute;
  left: 50%;
  top: 120%;
  transform: translateX(-50%);
  background: #fff;
  color: #24334d;
  border: 1px solid #b4c5d4;
  border-radius: 7px;
  padding: 10px 17px;
  box-shadow: 0 4px 16px #1976d211;
  font-size: 0.98em;
  z-index: 20;
  min-width: 180px;
  max-width: 350px;
  pointer-events: none;
}


.costumer-table-elegant thead th {
  background: #5b8db8;
  color: #fff;
  font-weight: 700;
  font-size: 1.09em;
  border: none;
  padding: 1.05em 0.7em;
  text-align: center;
  box-shadow: 0 2px 8px #0001;
  letter-spacing: 0.01em;
  font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
  position: sticky;
  top: 0;
  z-index: 2;
  transition: background 0.16s, color 0.16s;
}
.costumer-table-elegant thead th:first-child {
  border-top-left-radius: 11px;
}
.costumer-table-elegant thead th:last-child {
  border-top-right-radius: 11px;
}
.costumer-table-elegant thead tr {
  display: table-row;
}
.costumer-table-elegant tbody tr {
  transition: background 0.18s;
}
.costumer-table-elegant tbody tr:nth-child(even) {
  background: #f2f6fa;
}
.costumer-table-elegant tbody tr:nth-child(odd) {
  background: #fff;
}
.costumer-table-elegant tbody tr:hover {
  background: #e3f1fd;
  cursor: pointer;
}
.costumer-table-elegant td, .costumer-table-elegant th {
  padding: 10px 12px;
  border-radius: 7px;
}
.costumer-table-elegant td {
  border-bottom: 1px solid #e3e9f3;
  font-size: 0.99em;
}
.costumer-filters-elegant {
  background: #f8fbff;
  border-radius: 14px;
  border: 1.5px solid #e2e8f0;
  margin-bottom: 18px;
  box-shadow: 0 2px 8px #1976d211;
  padding: 18px 22px 10px 22px;
  display: flex;
  flex-wrap: wrap;
  gap: 12px 20px;
}
.costumer-filter-input {
  border-radius: 7px;
  border: 1.5px solid #b4c5d4;
  padding: 9px 13px;
  font-size: 1em;
  background: #fafdff;
  transition: border 0.15s;
  color: var(--text-main);
  min-width: 180px;
}
.costumer-filter-input:focus {
  outline: 2px solid var(--primary);
  border-color: var(--primary);
  background: #eaf6ff;
}
.costumer-btn-elegant {
  padding: 10px 22px;
  background: linear-gradient(90deg,#1976d2 60%,#2196f3 100%);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-weight: 700;
  cursor: pointer;
  font-size: 1.04em;
  box-shadow: 0 2px 8px #1976d211;
  transition: background 0.22s, box-shadow 0.18s;
}
.costumer-btn-elegant:hover {
  background: #1976d2;
  box-shadow: 0 4px 16px #1976d222;
}
.costumer-btn-clear {
  background: #eaf4fb !important;
  color: var(--primary) !important;
  border: 1.5px solid #b4c5d4 !important;
}
.costumer-btn-clear:hover {
  background: #dbefff !important;
  color: #1976d2 !important;
}
@media (max-width: 1200px) {
  .dashboard-flex-row {flex-direction:column; height:auto;}
  .crm-form-section{max-width:100%;margin-bottom:2.2em; height:auto; max-height:none; min-height:0;}
  .charts-section{min-width:0;}
  .costumer-table-elegant {min-width: 900px;}
}
html, body, .container, .main-content, .dashboard-flex-row, .crm-form-section, .charts-section {
  min-height: 0 !important;
}
/* Se agregó la llave de cierre faltante */

    .costumer-table {
      border-collapse:separate;
      border-spacing:0;
      width:100%;
      min-width:1350px;
      font-size: 1.01em;
    }
    .costumer-table thead th {
      background: #2196f3;
      color: #fff;
      font-weight: 800;
      font-size: 1.10em;
      border-bottom: 2px solid #1976d2;
      text-align: left;
      position: sticky;
    .costumer-table-wrapper::-webkit-scrollbar {
      height: 8px;
      background: #e3f2fd;
      border-radius: 8px;
    }
    .costumer-table-wrapper::-webkit-scrollbar-thumb {
      background: #b3e0ff;
      border-radius: 8px;
    }
    @media (max-width: 1200px) {
      .dashboard-flex-row {flex-direction:column; height:auto;}
      .crm-form-section{max-width:100%;margin-bottom:2.2em; height:auto; max-height:none; min-height:0;}
      .charts-section{min-width:0;}
    }
    html, body, .container, .main-content, .dashboard-flex-row, .crm-form-section, .charts-section {
      min-height: 0 !important;
    }
    /* Se agregó la llave de cierre faltante */
  }
  .td-ellipsis {
  max-width: 140px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  vertical-align: middle;
  cursor: pointer;
}
.td-nowrap {
  white-space: nowrap;
  vertical-align: middle;
}
.costumer-table-elegant th, .costumer-table-elegant td {
  text-align: center;
  vertical-align: middle;
  padding: 7px 9px;
  border-bottom: 1.5px solid #d5e4f3;
  border-right: 1px solid #e3e9f3;
}
.costumer-table-elegant th {
  position: sticky;
  top: 0;
  background: #5b8db8;
  z-index: 2;
}
.costumer-table-elegant tbody tr:nth-child(even) {
  background: #f5f9fc;
}
.costumer-table-elegant tbody tr:nth-child(odd) {
  background: #fff;
}
.costumer-table-elegant tbody tr:hover {
  background: #e3f1fd;
}
.costumer-table-wrapper {
  overflow-x: auto;
  min-width: 900px;
}
</style>
  <link rel="stylesheet" href="css/costumer-table-clean.css">
  <link rel="stylesheet" href="css/costumer-table-actions.css">
  <link rel="stylesheet" href="css/costumer-table-comments.css">
    
    <link rel="stylesheet" href="./css/lead-form-effects.css">
    <style>
      /* Forzando el layout de la pestaña Lead */
      .dashboard-flex-row#leadTab {
        display: grid;
        grid-template-columns: 44% 56%; /* Más espacio para gráficas */
        gap: 2.5rem;
        align-items: flex-start;
        height: calc(100vh - 80px);
      }

      /* Asegurando el scroll en el panel del formulario */
      .modern-form-container#form-panel {
        height: 100%;
        overflow-y: auto; /* Scroll vertical SOLO para el formulario */
      }
    </style>
</head>
<body>
  <div class="topbar">

    <div style="display:flex;align-items:center;gap:12px;">
      <i class="fas fa-user-tie" style="font-size:1.25em;color:#fff;margin-right:6px;"></i>
      <b>CRM Agente</b>
    </div>

  </div>
  <div class="container">
    <div class="sidebar">
      <h3>Menú</h3>
      <ul>
        <li><a href="#" id="nav-inicio"><i class="fas fa-home"></i> Inicio</a></li>
        <li><a href="#" id="nav-lead"><i class="fas fa-user-plus"></i> Lead</a></li>
        <li><a href="#" id="nav-costumer"><i class="fas fa-users"></i> Costumer</a></li>
      </ul>
    </div>
    <div class="main-content">

      <!-- SECCIÓN INICIO -->
      <div id="inicio-content" class="content-section">
        <div class="inicio-section" style="display: flex; align-items: center; justify-content: center; height: 80vh; width: 100%;">
          <div style="text-align:center;">
            <i class="fas fa-tools" style="font-size:3.5em;color:#1976d2;margin-bottom:18px;"></i>
            <h1 style="font-size:2.2em;color:#1976d2;margin-bottom:10px;">En construcción</h1>
            <div style="font-size:1.3em;color:#888;">By Zombie</div>
          </div>
        </div>
      </div>

      <!-- SECCIÓN LEAD -->
      <div id="lead-content" class="content-section">
        <div class="dashboard-flex-row" style="display: grid; grid-template-columns: auto 1fr; gap: 0; align-items: flex-start; height: calc(100vh - 80px);">
          <section class="modern-form-container" id="form-panel">
            <form id="lead-form" autocomplete="off">
              <div class="form-header-modern styled-form-header">
                <h2 class="form-title-modern styled-form-title"><i class="fas fa-user-edit"></i> Formulario de Registro</h2>
              </div>
              <div class="form-fields-unified">
                <h3 class="form-section-title"><i class="fas fa-user-circle"></i> Información del Cliente</h3>
                <div class="form-grid">
                  <div class="crm-form-group required" data-field="nombre_cliente"><label for="nombre_cliente" class="crm-form-label">Nombre cliente</label><div class="input-group"><i class="fas fa-user input-icon"></i><input type="text" name="nombre_cliente" id="nombre_cliente" class="crm-form-input" placeholder="Nombre completo" required></div><div class="error-message"></div></div>
                  <div class="crm-form-group required" data-field="telefono_principal"><label for="telefono_principal" class="crm-form-label">Teléfono principal</label><div class="input-group"><i class="fas fa-phone input-icon"></i><input type="tel" name="telefono_principal" id="telefono_principal" class="crm-form-input" placeholder="(555) 123-4567" required></div><div class="error-message"></div></div>
                  <div class="crm-form-group" data-field="telefono_alterno"><label for="telefono_alterno" class="crm-form-label">Teléfono Alterno</label><div class="input-group"><i class="fas fa-phone-alt input-icon"></i><input type="tel" name="telefono_alterno" id="telefono_alterno" class="crm-form-input" placeholder="Opcional"></div><div class="error-message"></div></div>
                  <div class="crm-form-group required" data-field="numero_cuenta"><label for="numero_cuenta" class="crm-form-label">Número de cuenta</label><div class="input-group"><i class="fas fa-hashtag input-icon"></i><input type="text" name="numero_cuenta" id="numero_cuenta" class="crm-form-input" placeholder="# de cuenta" required></div><div class="error-message"></div></div>
                  <div class="crm-form-group required" data-field="autopago"><label for="autopago" class="crm-form-label">Autopago</label><div class="input-group"><i class="fas fa-credit-card input-icon"></i><select name="autopago" id="autopago" class="crm-form-select" required><option value="" disabled selected>¿Cliente en Autopago?</option><option value="SI">SI</option><option value="NO">NO</option></select></div><div class="error-message"></div></div>
                  <div class="crm-form-group required full-width" data-field="direccion"><label for="direccion" class="crm-form-label">Dirección</label><div class="input-group"><i class="fas fa-map-marker-alt input-icon"></i><input type="text" name="direccion" id="direccion" class="crm-form-input" placeholder="Dirección completa" required></div><div class="error-message"></div></div>
                </div>

                <h3 class="form-section-title"><i class="fas fa-concierge-bell"></i> Información del Servicio</h3>
                <div class="form-grid">
                  <div class="crm-form-group required full-width" data-field="tipo_servicios"><label for="tipo_servicios" class="crm-form-label">Tipo de servicios</label><div class="input-group"><i class="fas fa-network-wired input-icon"></i><select name="tipo_servicios" id="tipo_servicios" class="crm-form-select" required>
  <option value="" disabled selected>Elige un tipo de servicio</option>
  <option value="VIDEO">VIDEO</option>
  <option value="INTERNET">INTERNET</option>
  <option value="AT&T AIR">AT&T AIR</option>
  <option value="WIRELESS">WIRELESS</option>
  <option value="SINGLE INTERNET">SINGLE INTERNET</option>
  <option value="FRONTIER">FRONTIER</option>
  <option value="WINDSTREAM">WINDSTREAM</option>
  <option value="OPTIMUM">OPTIMUM</option>
  <option value="WOW">WOW</option>
  <option value="ALTAFIBER">ALTAFIBER</option>
  <option value="CONSOLIDATE">CONSOLIDATE</option>
  <option value="HUGHESNET">HUGHESNET</option>
  <option value="VIASAT">VIASAT</option>
  <option value="CENTURYLINK">CENTURYLINK</option>
  <option value="METRONET">METRONET</option>
  <option value="ZIPLY FIBER">ZIPLY FIBER</option>
  <option value="HAWAIIAN">HAWAIIAN</option>
  <option value="DOUBLE PLAY">DOUBLE PLAY</option>
  <option value="VIVINT">VIVINT</option>
  <option value="BRIGHTSPEED">BRIGHTSPEED</option>
  <option value="MOBILITY">MOBILITY</option>
  <option value="SIM MOBILITY">SIM MOBILITY</option>
  <option value="EARTHLINK">EARTHLINK</option>
</select></div><div class="error-message"></div></div>
                <div class="crm-form-group required" data-field="sistema"><label for="sistema" class="crm-form-label">Sistema</label><div class="input-group"><i class="fas fa-server input-icon"></i><select name="sistema" id="sistema" class="crm-form-select" required>
  <option value="" disabled selected>Elige</option>
  <option value="SARA">SARA</option>
  <option value="OPUS">OPUS</option>
  <option value="B.O">B.O</option>
  <option value="N/A">N/A</option>
  <option value="CHUZO">CHUZO</option>
</select></div><div class="error-message"></div></div>
                <div class="crm-form-group required" data-field="riesgo"><label for="riesgo" class="crm-form-label">Riesgo</label><div class="input-group"><i class="fas fa-exclamation-triangle input-icon"></i><select name="riesgo" id="riesgo" class="crm-form-select" required>
  <option value="" disabled selected>Elige</option>
  <option value="LOW">LOW</option>
  <option value="MEDIUM">MEDIUM</option>
  <option value="HIGH">HIGH</option>
  <option value="N/A">N/A</option>
</select></div><div class="error-message"></div></div>
                <div class="crm-form-group required" data-field="dia_venta"><label for="dia_venta" class="crm-form-label">Día de venta</label><div class="input-group"><i class="fas fa-calendar-alt input-icon"></i><input type="date" name="dia_venta" id="dia_venta" class="crm-form-input" required></div><div class="error-message"></div></div>
                <div class="crm-form-group required" data-field="dia_instalacion"><label for="dia_instalacion" class="crm-form-label">Día de instalación</label><div class="input-group"><i class="fas fa-calendar-check input-icon"></i><input type="date" name="dia_instalacion" id="dia_instalacion" class="crm-form-input" required></div><div class="error-message"></div></div>
              </div>

              <h3 class="form-section-title"><i class="fas fa-info-circle"></i> Estado y Detalles</h3>
              <div class="form-grid">
                <div class="crm-form-group required" data-field="status">
  <label for="status" class="crm-form-label">Status</label>
  <div class="crm-form-radio-group">
    <label class="crm-form-radio-label">
      <input type="radio" name="status" value="PENDING" class="crm-form-radio-input" required> PENDING
    </label>
    <label class="crm-form-radio-label">
      <input type="radio" name="status" value="REPRO" class="crm-form-radio-input"> REPRO
    </label>
  </div>
  <div class="error-message"></div>
</div>
                <div class="crm-form-group required" data-field="servicios"><label for="servicios" class="crm-form-label">Servicios</label><div class="input-group"><i class="fas fa-briefcase input-icon"></i><select name="servicios" id="servicios" class="crm-form-select" required>
  <option value="" disabled selected>Elige un servicio</option>
  <option value="VIDEO DIRECTV VIA INTERNET">VIDEO DIRECTV VIA INTERNET</option>
  <option value="VIDEO DIRECTV VIA SATELITE">VIDEO DIRECTV VIA SATELITE</option>
  <option value="ATT AIR">ATT AIR</option>
  <option value="ATT 18 - 25 MB">ATT 18 - 25 MB</option>
  <option value="ATT 50 - 100 MB">ATT 50 - 100 MB</option>
  <option value="ATT 300 - 500 MB">ATT 300 - 500 MB</option>
  <option value="ATT 1G+">ATT 1G+</option>
  <option value="MOBILITY SPECTRUM">MOBILITY SPECTRUM</option>
  <option value="SIM SPECTRUM">SIM SPECTRUM</option>
  <option value="FRONTIER 200 MB">FRONTIER 200 MB</option>
  <option value="FRONTIER 500 MB">FRONTIER 500 MB</option>
  <option value="FRONTIER 1G">FRONTIER 1G</option>
  <option value="FRONTIER 2G+">FRONTIER 2G+</option>
  <option value="SPECTRUM 500">SPECTRUM 500</option>
  <option value="SPECTRUM 1G">SPECTRUM 1G</option>
  <option value="SPECTRUM 2G">SPECTRUM 2G</option>
  <option value="INTERNET WOW">INTERNET WOW</option>
  <option value="INTERNET ALTA FIBER">INTERNET ALTA FIBER</option>
  <option value="INTERNET WINDSTREAM">INTERNET WINDSTREAM</option>
  <option value="INTERNET HUGHESNET">INTERNET HUGHESNET</option>
  <option value="INTERNET VIASAT">INTERNET VIASAT</option>
  <option value="INTERNET CONSOLIDATE">INTERNET CONSOLIDATE</option>
  <option value="INTERNET CENTURILINK">INTERNET CENTURILINK</option>
  <option value="INTERNET METRONET">INTERNET METRONET</option>
  <option value="INTERNET ZIPLY FIBER">INTERNET ZIPLY FIBER</option>
  <option value="INTERNET HAWAIIAN">INTERNET HAWAIIAN</option>
  <option value="VIDEO SELECT SPECTRUM">VIDEO SELECT SPECTRUM</option>
  <option value="DOUBLE PLAY SPECTRUM">DOUBLE PLAY SPECTRUM</option>
  <option value="BRIGHTSPEED 10-100MBPS">BRIGHTSPEED 10-100MBPS</option>
  <option value="BRIGHTSPEED 100-900MBPS">BRIGHTSPEED 100-900MBPS</option>
  <option value="INTERNET OPTIMUM">INTERNET OPTIMUM</option>
  <option value="INTERNET EARTHLINK">INTERNET EARTHLINK</option>
</select></div><div class="error-message"></div></div>
                <div class="crm-form-group required" data-field="mercado"><label for="mercado" class="crm-form-label">Mercado</label><div class="input-group"><i class="fas fa-store input-icon"></i><select name="mercado" id="mercado" class="crm-form-select" required>
  <option value="" disabled selected>Elige</option>
  <option value="ICON">ICON</option>
  <option value="BAMO">BAMO</option>
</select></div><div class="error-message"></div></div>
              </div>

              <h3 class="form-section-title"><i class="fas fa-user-shield"></i> Supervisión y Motivo</h3>
              <div class="form-grid">
                <div class="crm-form-group required" data-field="supervisor"><label for="supervisor" class="crm-form-label">Supervisor</label><div class="input-group"><i class="fas fa-user-tie input-icon"></i><select name="supervisor" id="supervisor" class="crm-form-select" required>
  <option value="" disabled selected>Elige</option>
  <option value="IRANIA">IRANIA</option>
  <option value="ROBERTO">ROBERTO</option>
  <option value="MARISOL">MARISOL</option>
  <option value="PLEITEZ">PLEITEZ</option>
  <option value="RANDAL">RANDAL</option>
  <option value="JONATHAN">JONATHAN</option>
</select></div><div class="error-message"></div></div>
                <div class="crm-form-group required" data-field="comentario"><label for="comentario" class="crm-form-label">Comentario</label><div class="input-group"><i class="fas fa-comment-dots input-icon"></i><select name="comentario" id="comentario" class="crm-form-select" required>
  <option value="" disabled selected>Elige</option>
  <option value="ADQUIRIR SERVICIOS">ADQUIRIR SERVICIOS</option>
  <option value="CANCELAR SERVICIO ANTERIOR">CANCELAR SERVICIO ANTERIOR</option>
  <option value="QUITAR FEE $99.00">QUITAR FEE $99.00</option>
  <option value="CREAR ORDEN DE INTERNET">CREAR ORDEN DE INTERNET</option>
</select></div><div class="error-message"></div></div>
                <div class="crm-form-group required full-width" data-field="motivo_llamada">
                <label class="crm-form-label">¿Por qué llamó el cliente?</label>
                <div class="crm-form-radio-group" style="display: flex; flex-wrap: wrap; gap: 10px;">
                  <div style="flex: 1; min-width: 200px;">
                    <div style="display: block; margin-bottom: 8px;">
                      <label class="crm-form-radio-label"><input type="radio" name="motivo_llamada" value="BILL ALTO" class="crm-form-radio-input" required> BILL ALTO</label>
                    </div>
                    <div style="display: block; margin-bottom: 8px;">
                      <label class="crm-form-radio-label"><input type="radio" name="motivo_llamada" value="PROBLEMAS DE INTERNET" class="crm-form-radio-input"> PROBLEMAS DE INTERNET</label>
                    </div>
                    <div style="display: block; margin-bottom: 8px;">
                      <label class="crm-form-radio-label"><input type="radio" name="motivo_llamada" value="ADQUIRIR SERVICIOS" class="crm-form-radio-input"> ADQUIRIR SERVICIOS</label>
                    </div>
                  </div>
                  <div style="flex: 1; min-width: 200px;">
                    <div style="display: block; margin-bottom: 8px;">
                      <label class="crm-form-radio-label"><input type="radio" name="motivo_llamada" value="MUDANZA" class="crm-form-radio-input"> MUDANZA</label>
                    </div>
                    <div style="display: block; margin-bottom: 8px;">
                      <label class="crm-form-radio-label"><input type="radio" name="motivo_llamada" value="CANCELAR SERVICIOS" class="crm-form-radio-input"> CANCELAR SERVICIOS</label>
                    </div>
                    <div style="display: block; margin-bottom: 8px;">
                      <label class="crm-form-radio-label"><input type="radio" name="motivo_llamada" value="PAGAR BILL" class="crm-form-radio-input"> PAGAR BILL</label>
                    </div>
                    <div style="display: block; margin-bottom: 8px;">
                      <label class="crm-form-radio-label"><input type="radio" name="motivo_llamada" value="ATENCION AL CLIENTE" class="crm-form-radio-input"> ATENCION AL CLIENTE</label>
                    </div>
                  </div>
                </div>
                <div class="error-message"></div>
              </div>
              </div>

              <h3 class="form-section-title"><i class="fas fa-clipboard-check"></i> Datos Finales</h3>
              <div class="form-grid">
                <div class="crm-form-group required" data-field="zip_code"><label for="zip_code" class="crm-form-label">ZIP Code</label><div class="input-group"><i class="fas fa-mail-bulk input-icon"></i><input type="text" name="zip_code" id="zip_code" class="crm-form-input" placeholder="Código Postal" required></div><div class="error-message"></div></div>
                <div class="crm-form-group required" data-field="puntaje"><label for="puntaje" class="crm-form-label">Puntaje</label><div class="input-group"><i class="fas fa-star input-icon"></i><select name="puntaje" id="puntaje" class="crm-form-select" required><option value="" disabled selected>Selecciona un puntaje</option><option value="0.25">0.25</option><option value="0.35">0.35</option><option value="1.0">1.0</option><option value="1.25">1.25</option><option value="1.50">1.50</option></select></div><div class="error-message"></div></div>
              </div>

              <!-- Botón Guardar Lead -->
              <div class="form-actions" style="margin: 25px 0 50px 0; text-align: center; width: 100%;">
                <button type="submit" id="guardar-lead-btn" class="guardar-lead-btn" style="padding: 12px 40px; font-size: 1.1em; font-weight: 600; border-radius: 8px; background: #000000; color: white; border: none; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(30, 136, 229, 0.3);">
                  <i class="fas fa-save" style="margin-right: 8px;"></i>Guardar Lead
                </button>
              </div>
            </div> <!-- fin .form-fields-unified -->
          </form>

          <script src="js/core/script.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
          <script src="js/core/costumer-comments-clean.js"></script>
          <script src="js/core/graficas_nuevo.js"></script>
          <script src="js/core/dashboard-stats.js"></script>
          <script src="js/core/modern-lead-form.js"></script>
        </section>
        <!-- SECCIÓN DE GRÁFICAS -->
        <div class="charts-section">
          <div class="charts-filter">
            <label for="filter-date">Filtrar gráficas por fecha:</label>
            <input type="date" id="filter-date">
            <button id="apply-filter-btn"></button>
          </div>
          <div class="header-user-info">
            <span id="userName">Cargando...</span>
          </div>
          <button id="logoutBtn" style="background: transparent; border: none; color: #4B5563; cursor: pointer; font-size: 1.1em; margin-left: 15px;" title="Cerrar Sesión"><i class="fas fa-sign-out-alt"></i></button>
          <div class="chart-container">
            <canvas id="ventasTeamChart"></canvas>
          </div>
          <div class="chart-container">
            <canvas id="productosChart"></canvas>
          </div>
        </div>
        </section>
      </div>

      <!-- SECCIÓN COSTUMER -->
      <div id="costumer-content" class="content-section">
        <div class="dashboard-header">
          <h2><i class="fas fa-users"></i> Gestión de Clientes</h2>
          <div class="header-actions">
            <button id="refresh-costumers" class="btn-refresh" title="Actualizar lista">
              <i class="fas fa-sync-alt"></i> Actualizar
            </button>
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input type="text" id="search-costumer" placeholder="Buscar cliente...">
            </div>
          </div>
        </div>

        <div class="costumer-table-wrapper">
          <table class="costumer-table-elegant">
            <thead>
              <tr>
                <th>Nombre cliente</th>
                <th>Teléfono principal</th>
                <th>Teléfono alterno</th>
                <th>Número de cuenta</th>
                <th>Autopago</th>
                <th>Dirección</th>
                <th>Tipo de servicios</th>
                <th>Sistema</th>
                <th>Riesgo</th>
                <th>Día de venta</th>
                <th>Día de instalación</th>
                <th>Status</th>
                <th>Servicios</th>
                <th>Mercado</th>
                <th>Supervisor</th>
                <th>Comentario</th>
                <th>Motivo llamada</th>
                <th>ZIP CODE</th>
                <th>Puntaje</th>
                <th>Comentarios sobre la venta</th>
                <th>Acción</th>
              </tr>
            </thead>
            <tbody id="costumer-table-body">
              <!-- Los datos de los clientes se cargarán aquí dinámicamente -->
            </tbody>
          </table>
        </div>

        <!-- Modal para comentarios -->
        <div id="modal-comentarios" class="modal" style="display: none;">
          <div class="modal-content">
            <div class="modal-header">
              <h3>Comentarios del Cliente</h3>
              <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
              <div id="comentarios-lista" class="comentarios-lista">
                <!-- Los comentarios se cargarán aquí -->
              </div>
              <div class="nuevo-comentario">
                <h4>Agregar Comentario</h4>
                <textarea id="nuevo-comentario-texto" placeholder="Escribe tu comentario aquí..."></textarea>
                <button id="btn-guardar-comentario" class="btn-guardar">
                  <i class="fas fa-save"></i> Guardar Comentario
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Sección de tarjetas resumen -->
      <div class="summary-cards-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 24px; margin-bottom: 2.5rem; width: 100%;">
        <!-- Tarjeta de Ventas de Hoy -->
        <div class="summary-card sales-today">
          <div class="card-content">
            <div class="card-header">
              <div class="card-icon" style="background: linear-gradient(135deg, #4caf50, #66bb6a);">
                <i class="fas fa-shopping-cart"></i>
              </div>
              <h3 class="card-title">Ventas de Hoy</h3>
            </div>
            <div class="card-value" id="ventas-hoy">0</div>
            <div class="card-footer">
              <i class="fas fa-calendar-day"></i>
              <span>Actualizado: <span id="fecha-ventas-hoy">Hoy</span></span>
            </div>
          </div>
        </div>
        
        <!-- Tarjeta de Clientes Pendientes -->
        <div class="summary-card pending-clients">
          <div class="card-content">
            <div class="card-header">
              <div class="card-icon" style="background: linear-gradient(135deg, #ff9800, #ffa726);">
                <i class="fas fa-user-clock"></i>
              </div>
              <h3 class="card-title">Clientes Pendientes</h3>
            </div>
            <div class="card-value" id="clientes-pendientes">0</div>
            <div class="card-footer">
              <i class="fas fa-clock"></i>
              <span>Por contactar</span>
            </div>
          </div>
        </div>
        
        <!-- Tarjeta de Ventas del Mes -->
        <div class="summary-card monthly-sales">
          <div class="card-content">
            <div class="card-header">
              <div class="card-icon" style="background: linear-gradient(135deg, #2196f3, #42a5f5);">
                <i class="fas fa-chart-line"></i>
              </div>
              <h3 class="card-title">Ventas del Mes</h3>
            </div>
            <div class="card-value" id="ventas-mes">0</div>
            <div class="card-footer">
              <i class="fas fa-calendar-alt"></i>
              <span id="mes-actual">Mes actual</span>
            </div>
          </div>
        </div>
        
        <!-- Tarjeta de Ventas Canceladas -->
        <div class="summary-card canceled-sales">
          <div class="card-content">
            <div class="card-header">
              <div class="card-icon" style="background: linear-gradient(135deg, #f44336, #ef5350);">
                <i class="fas fa-times-circle"></i>
              </div>
              <h3 class="card-title">Ventas Canceladas</h3>
            </div>
            <div class="card-value" id="ventas-canceladas">0</div>
            <div class="card-footer">
              <i class="fas fa-exclamation-triangle"></i>
              <span>Este mes</span>
            </div>
          </div>
        </div>
      </div>
      
      <style>
          
          .summary-card {
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            padding: 1.5rem 1.5rem 1.8rem;
            transition: all 0.3s ease;
            border: 1px solid #e9edf4;
            position: relative;
            overflow: hidden;
          }
          
          .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
          }
          
          .summary-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
          }
          
          .summary-card.sales-today::before { background: linear-gradient(135deg, #4caf50, #66bb6a); }
          .summary-card.pending-clients::before { background: linear-gradient(135deg, #ff9800, #ffa726); }
          .summary-card.canceled-sales::before { background: linear-gradient(135deg, #f44336, #ef5350); }
          .summary-card.monthly-sales::before { background: linear-gradient(135deg, #2196f3, #42a5f5); }
          
          .card-content {
            display: flex;
            flex-direction: column;
            height: 100%;
          }
          
          .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
          }
          
          .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            font-size: 1.5rem;
            color: white;
          }
          
          .card-title {
            font-size: 1rem;
            font-weight: 500;
            color: #5a6a85;
            margin: 0;
            line-height: 1.4;
          }
          
          .card-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #2c3e50;
            margin: 0.5rem 0 0.2rem;
            line-height: 1.2;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
          }
          
          .card-footer {
            margin-top: auto;
            font-size: 0.8rem;
            color: #7f8c9a;
            display: flex;
            align-items: center;
          }
          
          .card-footer i {
            margin-right: 4px;
            font-size: 0.9em;
          }
          
          @media (max-width: 1200px) {
            .summary-cards-container {
              grid-template-columns: repeat(2, 1fr);
            }
          }
          
          @media (max-width: 768px) {
            .summary-cards-container {
              grid-template-columns: 1fr;
            }
    }

    /* Estilos para la tabla de clientes */
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding: 0 0.5rem;
    }
    
    .dashboard-header h2 {
        margin: 0;
        color: #2c3e50;
        font-size: 1.5rem;
        font-weight: 600;
    }
    
    .header-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
    }
    
    .btn-refresh {
        background: #3498db;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 0.5rem 1rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        transition: all 0.2s ease;
    }
    
    .btn-refresh:hover {
        background: #2980b9;
        transform: translateY(-1px);
    }
    
    .search-box {
        position: relative;
        display: flex;
        align-items: center;
    }
    
    .search-box i {
        position: absolute;
        left: 10px;
        color: #7f8c8d;
    }
    
    .search-box input {
        padding: 0.5rem 1rem 0.5rem 2rem;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 0.9rem;
        width: 250px;
        transition: all 0.2s ease;
    }
    
    .search-box input:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }
    
    .costumer-table-wrapper {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        padding: 1.5rem;
        margin-bottom: 2rem;
        overflow-x: auto;
    }
    
    .costumer-table-elegant {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
    }
    
    .costumer-table-elegant th {
        background-color: #f8f9fa;
        color: #495057;
        font-weight: 600;
        text-align: left;
        padding: 0.75rem 1rem;
        white-space: nowrap;
        border-bottom: 2px solid #e9ecef;
    }
    
    .costumer-table-elegant td {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #e9ecef;
        vertical-align: middle;
    }
    
    .costumer-table-elegant tbody tr:last-child td {
        border-bottom: none;
    }
    
    .costumer-table-elegant tbody tr:hover {
        background-color: #f8f9fa;
    }
    
    .badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .badge-secondary {
        background-color: #6c757d;
        color: white;
    }
    
    .badge-success {
        background-color: #28a745;
        color: white;
    }
    
    .badge-warning {
        background-color: #ffc107;
        color: #212529;
    }
    
    .badge-danger {
        background-color: #dc3545;
        color: white;
    }
    
    .status-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: capitalize;
    }
    
    .status-success {
        background-color: rgba(40, 167, 69, 0.1);
        color: #28a745;
        border: 1px solid rgba(40, 167, 69, 0.2);
    }
    
    .status-warning {
        background-color: rgba(255, 193, 7, 0.1);
        color: #ffc107;
        border: 1px solid rgba(255, 193, 7, 0.2);
    }
    
    .status-danger {
        background-color: rgba(220, 53, 69, 0.1);
        color: #dc3545;
        border: 1px solid rgba(220, 53, 69, 0.2);
    }
    
    .status-secondary {
        background-color: rgba(108, 117, 125, 0.1);
        color: #6c757d;
        border: 1px solid rgba(108, 117, 125, 0.2);
    }
    
    .action-buttons {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
    }
    
    .btn-action {
        background: none;
        border: none;
        width: 32px;
        height: 32px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .btn-action i {
        font-size: 1rem;
    }
    
    .btn-edit {
        color: #3498db;
        background-color: rgba(52, 152, 219, 0.1);
    }
    
    .btn-edit:hover {
        background-color: rgba(52, 152, 219, 0.2);
    }
    
    .btn-comments {
        color: #2ecc71;
        background-color: rgba(46, 204, 113, 0.1);
    }
    
    .btn-comments:hover {
        background-color: rgba(46, 204, 113, 0.2);
    }
    
    .btn-delete {
        color: #e74c3c;
        background-color: rgba(231, 76, 60, 0.1);
    }
    
    .btn-delete:hover {
        background-color: rgba(231, 76, 60, 0.2);
    }
    
    .text-center {
        text-align: center;
    }
    
    /* Estilos para el modal de comentarios */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }
    
    .modal-content {
        background: white;
        border-radius: 10px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        display: flex;
        flex-direction: column;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    }
    
    .modal-header {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .modal-header h3 {
        margin: 0;
        font-size: 1.25rem;
        color: #2c3e50;
    }
    
    .close-modal {
        font-size: 1.5rem;
        color: #6c757d;
        cursor: pointer;
        background: none;
        border: none;
        line-height: 1;
    }
    
    .close-modal:hover {
        color: #2c3e50;
    }
    
    .modal-body {
        padding: 1.5rem;
        overflow-y: auto;
        flex: 1;
    }
    
    .comentarios-lista {
        margin-bottom: 1.5rem;
        max-height: 300px;
        overflow-y: auto;
    }
    
    .comentario-item {
        padding: 1rem;
        border-bottom: 1px solid #e9ecef;
    }
    
    .comentario-item:last-child {
        border-bottom: none;
    }
    
    .comentario-meta {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
        font-size: 0.8rem;
        color: #6c757d;
    }
    
    .comentario-texto {
        color: #2c3e50;
        line-height: 1.5;
    }
    
    .nuevo-comentario h4 {
        margin-top: 0;
        margin-bottom: 0.75rem;
        color: #2c3e50;
        font-size: 1rem;
    }
    
    .nuevo-comentario textarea {
        width: 100%;
        min-height: 100px;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 6px;
        margin-bottom: 1rem;
        font-family: inherit;
        resize: vertical;
    }
    
    .nuevo-comentario textarea:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }
    
    .btn-guardar {
        background: #3498db;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 0.5rem 1.25rem;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.2s ease;
    }
    
    .btn-guardar:hover {
        background: #2980b9;
        transform: translateY(-1px);
    }
    
    /* Ocultar secciones de contenido por defecto */
    .content-section {
      display: none;
    }
  </style>

  <script>
    // Inicializar el dashboard directamente sin verificación de autenticación
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM completamente cargado');
      initApp();
    });

    function initApp() {
      console.log('Inicializando aplicación...');
      // Configurar usuario predeterminado
      if (!localStorage.getItem('user')) {
        localStorage.setItem('user', JSON.stringify({
          nombre: 'Usuario Demo',
          rol: 'agente',
          email: 'demo@example.com'
        }));
      }
      
      // Inicializar dashboard
      initDashboard();
    }

    function initDashboard() {
      console.log('Inicializando dashboard...');
      // Lógica de navegación del dashboard
      const navLinks = {
        'nav-inicio': 'inicio-content',
        'nav-lead': 'lead-content',
        'nav-costumer': 'costumer-content'
      };

      function showSection(sectionId) {
        try {
          console.log('Mostrando sección:', sectionId);
          // Ocultar todas las secciones
          document.querySelectorAll('.content-section').forEach(section => {
            section.style.display = 'none';
          });
          
          // Mostrar la sección activa
          const activeSection = document.getElementById(sectionId);
          if (activeSection) {
            activeSection.style.display = 'block';
            console.log('Sección mostrada correctamente');
          } else {
            console.error(`No se encontró la sección con ID: ${sectionId}`);
          }
        } catch (error) {
          console.error('Error en showSection:', error);
          if (window.mostrarMensaje) {
            window.mostrarMensaje('Error al cambiar de sección', 'error');
          }
        }
      }

      // Configurar event listeners para la navegación
      Object.keys(navLinks).forEach(linkId => {
        const link = document.getElementById(linkId);
        if (link) {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            showSection(navLinks[linkId]);
          });
        }
      });

      // Mostrar la sección de inicio por defecto
      showSection('inicio-content');

      // Cargar datos iniciales con manejo de errores mejorado
      (async () => {
        try {
          await Promise.all([
            refrescarLeadsAgente(),
            cargarCostumers()
          ]);
        } catch (error) {
          console.error('Error al cargar datos iniciales:', error);
          if (window.mostrarMensaje) {
            window.mostrarMensaje('Error al cargar los datos iniciales', 'error');
          }
        }
      })();
    }

// Función para manejar la carga de clientes
  function handleCostumerSectionLoad() {
    console.log('Sección de costumers mostrada, cargando datos...');
    cargarCostumers();
  }

  // Inicialización de la aplicación
  function initApp() {
    // Actualizar el mes actual en la tarjeta de ventas del mes
    const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
    const fecha = new Date();
    const mesActualElement = document.getElementById('mes-actual');
    if (mesActualElement) {
      mesActualElement.textContent = `${meses[fecha.getMonth()]} ${fecha.getFullYear()}`;
    }
    
    // Formatear fecha de actualización
    const opcionesFecha = { day: '2-digit', month: '2-digit', year: 'numeric' };
    const opcionesHora = { hour: '2-digit', minute: '2-digit' };
    const ahora = new Date();
    const fechaActualizacionElement = document.getElementById('fecha-actualizacion');
    if (fechaActualizacionElement) {
      fechaActualizacionElement.textContent = 
        `Última actualización: ${ahora.toLocaleDateString('es-MX', opcionesFecha)} a las ${ahora.toLocaleTimeString('es-MX', opcionesHora)}`;
    }
    
    // Inicializar eventos de la tabla de clientes
    inicializarEventosTablaClientes();
    
    // Cargar datos iniciales
    cargarDatosIniciales();
    
    // Configurar eventos de navegación
    const navCostumer = document.getElementById('nav-costumer');
    if (navCostumer) {
      navCostumer.addEventListener('click', function() {
        console.log('Navegación a costumers detectada');
        // Pequeño retraso para asegurar que la transición de la pestaña se complete
        setTimeout(handleCostumerSectionLoad, 100);
      });
    }
    
    // Verificar si la sección de costumers ya está visible
    const costumerSection = document.getElementById('costumer-content');
    if (costumerSection && window.getComputedStyle(costumerSection).display === 'block') {
      console.log('La sección de costumers ya está visible al cargar la página');
      handleCostumerSectionLoad();
    }
  }
  
  // Función para cargar los datos iniciales
  async function cargarDatosIniciales() {
    try {
      await Promise.all([
        refrescarLeadsAgente(),
        cargarCostumers(),
        cargarDatosResumen()
      ]);
    } catch (error) {
      console.error('Error al cargar datos iniciales:', error);
      if (window.mostrarMensaje) {
        window.mostrarMensaje('Error al cargar los datos iniciales', 'error');
      }
      // Establecer valores por defecto en caso de error
      const defaultValues = {
        'ventas-hoy': '0',
        'clientes-pendientes': '0',
        'ventas-mes': '0',
        'ventas-canceladas': '0'
      };
      
      Object.entries(defaultValues).forEach(([id, value]) => {
        const element = document.getElementById(id);
        if (element) element.textContent = value;
      });
    }
  }

  // Inicializar la aplicación cuando el DOM esté listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM completamente cargado');
      initApp();
    });
  } else {
    console.log('DOM ya estaba cargado');
    initApp();
  }

/**
 * Obtiene los leads del agente desde la API y los renderiza en la tabla y gráficos.
 */
async function refrescarLeadsAgente() {
    try {
        console.log('Obteniendo leads del agente...');
        const response = await fetch('/api/leads');
        if (!response.ok) {
            throw new Error(`Error del servidor: ${response.status}`);
        }
        const leads = await response.json();
        console.log('Leads obtenidos:', leads.length);
        
        // Renderizar los datos en las tablas y gráficos correspondientes
        if (typeof renderTablaLeadAgente === 'function') {
            console.log('Llamando a renderTablaLeadAgente...');
            renderTablaLeadAgente(leads);
        }
        if (typeof renderCostumerGroupedByDate === 'function') {
            console.log('Llamando a renderCostumerGroupedByDate...');
            renderCostumerGroupedByDate(leads);
        }
        if (typeof renderGraficas === 'function') {
            console.log('Llamando a renderGraficas...');
            renderGraficas(leads);
        } else {
            console.error('renderGraficas no está definido');
        }

    } catch (error) {
        console.error('Error al obtener los leads del agente:', error);
    }
}

/**
 * Carga los clientes desde la API y los muestra en la tabla
 */
async function cargarCostumers() {
    try {
        console.log('Cargando clientes...');
        const response = await fetch('/api/leads');
        if (!response.ok) {
            throw new Error(`Error del servidor: ${response.status}`);
        }
        const clientes = await response.json();
        console.log('Clientes cargados:', clientes.length);
        
        // Renderizar la tabla de clientes
        renderTablaClientes(clientes);
        
    } catch (error) {
        console.error('Error al cargar los clientes:', error);
        if (window.mostrarMensaje) {
            window.mostrarMensaje('Error al cargar los clientes: ' + error.message, 'error');
        }
    }
}

/**
 * Renderiza la tabla de clientes con los datos proporcionados
 * @param {Array} clientes - Lista de clientes a mostrar
 */
function renderTablaClientes(clientes) {
    const tbody = document.getElementById('costumer-table-body');
    if (!tbody) {
        console.error('No se encontró el elemento tbody para la tabla de clientes');
        return;
    }
    
    // Limpiar la tabla
    tbody.innerHTML = '';
    
    if (!Array.isArray(clientes) || clientes.length === 0) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td colspan="21" class="text-center">
                No se encontraron clientes registrados
            </td>
        `;
        tbody.appendChild(tr);
        return;
    }
    
    // Ordenar clientes por fecha de venta (más recientes primero)
    clientes.sort((a, b) => {
        const fechaA = a.dia_venta ? new Date(a.dia_venta) : new Date(0);
        const fechaB = b.dia_venta ? new Date(b.dia_venta) : new Date(0);
        return fechaB - fechaA;
    });
    
    // Agregar cada cliente a la tabla
    clientes.forEach(cliente => {
        const tr = document.createElement('tr');
        tr.dataset.id = cliente._id || '';
        
        // Formatear fechas
        const fechaVenta = cliente.dia_venta ? new Date(cliente.dia_venta).toLocaleDateString('es-MX') : 'N/A';
        const fechaInstalacion = cliente.dia_instalacion ? new Date(cliente.dia_instalacion).toLocaleDateString('es-MX') : 'N/A';
        
        // Determinar clase de riesgo
        const riesgoClass = getRiesgoClass(cliente.riesgo);
        
        tr.innerHTML = `
            <td>${escapeHtml(cliente.nombre_cliente || 'N/A')}</td>
            <td>${escapeHtml(cliente.telefono_principal || 'N/A')}</td>
            <td>${escapeHtml(cliente.telefono_alterno || 'N/A')}</td>
            <td>${escapeHtml(cliente.numero_cuenta || 'N/A')}</td>
            <td>${escapeHtml(cliente.autopago || 'N/A')}</td>
            <td>${escapeHtml(cliente.direccion || 'N/A')}</td>
            <td>${escapeHtml(cliente.tipo_servicios || 'N/A')}</td>
            <td>${escapeHtml(cliente.sistema || 'N/A')}</td>
            <td><span class="badge ${riesgoClass}">${escapeHtml(cliente.riesgo || 'N/A')}</span></td>
            <td>${fechaVenta}</td>
            <td>${fechaInstalacion}</td>
            <td><span class="status-badge ${getStatusClass(cliente.status)}">${escapeHtml(cliente.status || 'N/A')}</span></td>
            <td>${escapeHtml(cliente.servicios || 'N/A')}</td>
            <td>${escapeHtml(cliente.mercado || 'N/A')}</td>
            <td>${escapeHtml(cliente.supervisor || 'N/A')}</td>
            <td>${escapeHtml(cliente.comentario || 'N/A')}</td>
            <td>${escapeHtml(cliente.motivo_llamada || 'N/A')}</td>
            <td>${escapeHtml(cliente.zip_code || 'N/A')}</td>
            <td>${escapeHtml(cliente.puntaje || 'N/A')}</td>
            <td>${escapeHtml(cliente.comentarios_venta || 'N/A')}</td>
            <td class="action-buttons">
                <button class="btn-action btn-edit" title="Editar" onclick="editarCliente('${cliente._id || ''}')">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn-action btn-comments" title="Comentarios" onclick="mostrarComentariosCostumer('${cliente._id || ''}', event)">
                    <i class="fas fa-comments"></i>
                </button>
            </td>
        `;
        
        tbody.appendChild(tr);
    });
    
    // Inicializar eventos de la tabla
    inicializarEventosTablaClientes();
}

/**
 * Obtiene la clase CSS para el indicador de riesgo
 */
function getRiesgoClass(riesgo) {
    if (!riesgo) return 'badge-secondary';
    
    const riesgoLower = riesgo.toLowerCase();
    if (riesgoLower.includes('alto')) return 'badge-danger';
    if (riesgoLower.includes('medio')) return 'badge-warning';
    if (riesgoLower.includes('bajo')) return 'badge-success';
    
    return 'badge-secondary';
}

/**
 * Obtiene la clase CSS para el estado del cliente
 */
function getStatusClass(status) {
    if (!status) return 'status-secondary';
    
    const statusLower = status.toLowerCase();
    if (['activo', 'completado', 'aprobado'].some(s => statusLower.includes(s))) return 'status-success';
    if (['pendiente', 'en proceso', 'en revisión'].some(s => statusLower.includes(s))) return 'status-warning';
    if (['cancelado', 'rechazado', 'inactivo'].some(s => statusLower.includes(s))) return 'status-danger';
    
    return 'status-secondary';
}

/**
 * Inicializa los eventos de la tabla de clientes
 */
function inicializarEventosTablaClientes() {
    // Evento de búsqueda
    const searchInput = document.getElementById('search-costumer');
    if (searchInput) {
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#costumer-table-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
    }
    
    // Evento de actualización
    const refreshBtn = document.getElementById('refresh-costumers');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', cargarCostumers);
    }
}

/**
 * Función para cargar los datos del resumen
 */
async function cargarDatosResumen() {
    try {
        const response = await fetch('/api/leads/resumen');
        if (!response.ok) {
            throw new Error('Error al cargar los datos del resumen');
        }
        const data = await response.json();
        
        // Actualizar las tarjetas con los datos recibidos
        if (data.ventasHoy !== undefined) {
            document.getElementById('ventas-hoy').textContent = data.ventasHoy;
        }
        if (data.clientesPendientes !== undefined) {
            document.getElementById('clientes-pendientes').textContent = data.clientesPendientes;
        }
        if (data.ventasMes !== undefined) {
            document.getElementById('ventas-mes').textContent = data.ventasMes;
        }
        if (data.ventasCanceladas !== undefined) {
            document.getElementById('ventas-canceladas').textContent = data.ventasCanceladas;
        }
    } catch (error) {
        console.error('Error al cargar los datos del resumen:', error);
        // Mostrar valores por defecto en caso de error
        document.getElementById('ventas-hoy').textContent = '0';
        document.getElementById('clientes-pendientes').textContent = '0';
        document.getElementById('ventas-mes').textContent = '0';
        document.getElementById('ventas-canceladas').textContent = '0';
    }
}

/**
 * Función auxiliar para escapar HTML
 */
function escapeHtml(unsafe) {
    if (unsafe === null || unsafe === undefined) return '';
    return unsafe
        .toString()
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
}

/**
 * Renderiza la tabla de leads del agente
 * @param {Array} leads - Lista de leads a mostrar
 */
function renderTablaLeadAgente(leads) {
    console.log('Renderizando tabla de leads:', leads);
    const tbody = document.querySelector('#tabla-leads tbody');
    if (!tbody) {
      console.error('No se encontró el elemento tbody para la tabla de leads');
      return;
    }
    
    // Limpiar tabla
    tbody.innerHTML = '';
    
    if (!leads || leads.length === 0) {
      tbody.innerHTML = '<tr><td colspan="10" class="text-center">No hay datos disponibles</td></tr>';
      return;
    }
    
    // Crear filas para cada lead
    leads.forEach(lead => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${lead.nombre || lead.NOMBRE || ''}</td>
        <td>${lead.telefono || lead.TELEFONO || lead.TEL || ''}</td>
        <td>${lead.telefono_alterno || lead.TELEFONO_ALTERNO || lead.TEL_ALTERNO || ''}</td>
        <td>${lead.cuenta || lead.CUENTA || ''}</td>
        <td>${lead.autopago || lead.AUTOPAGO || ''}</td>
        <td>${lead.direccion || lead.DIRECCION || ''}</td>
        <td>${lead.tipo_servicio || lead.TIPO_SERVICIO || lead.SERVICIO || ''}</td>
        <td>${lead.sistema || lead.SISTEMA || ''}</td>
        <td><span class="badge ${getRiesgoClass(lead.riesgo || lead.RIESGO)}">${lead.riesgo || lead.RIESGO || ''}</span></td>
        <td>${lead.dia_venta || lead.DIA_VENTA || lead.FECHA || ''}</td>
        <td>${lead.dia_instalacion || lead.DIA_INSTALACION || ''}</td>
        <td><span class="badge ${getStatusClass(lead.status || lead.STATUS || lead.ESTADO)}">${lead.status || lead.STATUS || lead.ESTADO || ''}</span></td>
        <td>${lead.servicios || lead.SERVICIOS || ''}</td>
        <td>${lead.mercado || lead.MERCADO || ''}</td>
        <td>${lead.supervisor || lead.SUPERVISOR || ''}</td>
        <td>${lead.comentario || lead.COMENTARIO || ''}</td>
        <td>${lead.motivo_llamada || lead.MOTIVO_LLAMADA || ''}</td>
        <td>${lead.zip || lead.ZIP || lead.CODIGO_POSTAL || ''}</td>
        <td>${lead.puntaje || lead.PUNTAJE || ''}</td>
        <td>${lead.comentarios_venta || lead.COMENTARIOS_VENTA || ''}</td>
        <td class="text-center">
          <button class="btn btn-sm btn-primary editar-lead" data-id="${lead._id || lead.ID || ''}">
            <i class="fas fa-edit"></i>
          </button>
        </td>
      `;
      tbody.appendChild(tr);
    });
    
    // Inicializar eventos de la tabla
    inicializarEventosTablaClientes();
}

/**
 * Agrupa y muestra los clientes por fecha
 * @param {Array} leads - Lista de leads
 */
function renderCostumerGroupedByDate(leads) {
    console.log('Renderizando agrupación de clientes por fecha');
    if (!leads || leads.length === 0) {
      console.log('No hay datos para agrupar por fecha');
      return;
    }
    
    // Agrupar por fecha (usando el primer campo de fecha disponible)
    const groupedByDate = leads.reduce((acc, lead) => {
      const fecha = lead.dia_venta || lead.DIA_VENTA || lead.FECHA || lead.fecha_creacion || 'Sin fecha';
      if (!acc[fecha]) {
        acc[fecha] = 0;
      }
      acc[fecha]++;
      return acc;
    }, {});
    
    console.log('Clientes agrupados por fecha:', groupedByDate);
    
    // Actualizar la interfaz con los datos agrupados
    const container = document.getElementById('grouped-by-date-container');
    if (container) {
      container.innerHTML = `
        <h3>Clientes por Fecha</h3>
        <div class="date-groups">
          ${Object.entries(groupedByDate).map(([fecha, cantidad]) => `
            <div class="date-group">
              <span class="date">${fecha}:</span>
              <span class="count">${cantidad} cliente${cantidad !== 1 ? 's' : ''}</span>
            </div>
          `).join('')}
        </div>
      `;
    }
}

/**
 * Renderiza las gráficas del dashboard
 * @param {Array} leads - Lista de leads para las gráficas
 */
function renderGraficas(leads) {
    console.log('Renderizando gráficas con datos:', leads);
    if (!leads || leads.length === 0) {
      console.log('No hay datos para mostrar en las gráficas');
      return;
    }
    
    // Gráfica de ventas por día
    const ctxVentas = document.getElementById('ventasChart');
    if (ctxVentas) {
      // Procesar datos para la gráfica
      const ventasPorDia = {};
      leads.forEach(lead => {
        const fecha = lead.dia_venta || lead.DIA_VENTA || lead.FECHA || 'Sin fecha';
        ventasPorDia[fecha] = (ventasPorDia[fecha] || 0) + 1;
      });
      
      const fechas = Object.keys(ventasPorDia);
      const cantidades = fechas.map(fecha => ventasPorDia[fecha]);
      
      // Destruir gráfica anterior si existe
      if (window.ventasChart) {
        window.ventasChart.destroy();
      }
      
      // Crear nueva gráfica
      window.ventasChart = new Chart(ctxVentas, {
        type: 'bar',
        data: {
          labels: fechas,
          datasets: [{
            label: 'Ventas por día',
            data: cantidades,
            backgroundColor: 'rgba(25, 118, 210, 0.5)',
            borderColor: 'rgba(25, 118, 210, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            },
            title: {
              display: true,
              text: 'Ventas por Día',
              font: {
                size: 16
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });
    }
    
    // Gráfica de productos/servicios
    const ctxProductos = document.getElementById('productosChart');
    if (ctxProductos) {
      const productos = leads.reduce((acc, lead) => {
        const producto = lead.tipo_servicio || lead.TIPO_SERVICIO || lead.SERVICIO || 'Sin especificar';
        acc[producto] = (acc[producto] || 0) + 1;
        return acc;
      }, {});
      
      // Destruir gráfica anterior si existe
      if (window.productosChart) {
        window.productosChart.destroy();
      }
      
      // Crear nueva gráfica
      window.productosChart = new Chart(ctxProductos, {
        type: 'pie',
        data: {
          labels: Object.keys(productos),
          datasets: [{
            data: Object.values(productos),
            backgroundColor: [
              'rgba(25, 118, 210, 0.5)',
              'rgba(76, 175, 80, 0.5)',
              'rgba(255, 152, 0, 0.5)',
              'rgba(233, 30, 99, 0.5)',
              'rgba(156, 39, 176, 0.5)'
            ],
            borderColor: [
              'rgba(25, 118, 210, 1)',
              'rgba(76, 175, 80, 1)',
              'rgba(255, 152, 0, 1)',
              'rgba(233, 30, 99, 1)',
              'rgba(156, 39, 176, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom',
            },
            title: {
              display: true,
              text: 'Distribución por Servicio',
              font: {
                size: 16
              }
            }
          }
        }
      });
    }
}

/**
 * Inicializa los eventos de la tabla de clientes
 */
function inicializarEventosTablaClientes() {
    console.log('Inicializando eventos de la tabla de clientes');
    
    // Evento para el botón de editar
    document.querySelectorAll('.editar-lead').forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const leadId = this.getAttribute('data-id');
        console.log('Editar lead:', leadId);
        // Aquí puedes implementar la lógica para editar el lead
        if (window.mostrarMensaje) {
          window.mostrarMensaje(`Editar lead con ID: ${leadId}`, 'info');
        }
      });
    });
    
    // Evento para el botón de eliminar (si existe)
    document.querySelectorAll('.eliminar-lead').forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const leadId = this.getAttribute('data-id');
        console.log('Eliminar lead:', leadId);
        // Aquí puedes implementar la lógica para eliminar el lead
        if (window.mostrarMensaje) {
          window.mostrarMensaje(`Eliminar lead con ID: ${leadId}`, 'warning');
        }
      });
    });
}

</script>
</body>
</html>
