<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>CRM Agente</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-minimal/minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="css/dashboard.css">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/crm-form-styles.css">


  <style>
    /* --- ESTILO FORZADO PARA TABLA DE CLIENTES --- */
    div.costumer-table-container, .costumer-table-container {
      width: 100% !important;
      overflow-x: auto !important;
      background: #fff !important;
      padding: 0 !important;
      margin-bottom: 24px !important;
      border-radius: 18px 18px 0 0 !important;
      box-shadow: 0 6px 28px #1976d220 !important;
    }
    table.costumer-table-elegant, .costumer-table-elegant {
      width: 100% !important;
      border-collapse: separate !important;
      border-spacing: 0 !important;
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif !important;
      color: #0a2540 !important;
      font-size: 1.08em !important;
      background: #fff !important;
      border-radius: 18px 18px 0 0 !important;
      overflow: hidden !important;
    }
    .costumer-table-elegant thead th {
      position: sticky !important;
      top: 0 !important;
      z-index: 10 !important;
      background: #f8fafc !important;
      color: #0f172a !important;
      font-weight: 500 !important;
      padding: 16px 16px !important;
      text-align: left !important;
      border: none !important;
      border-bottom: 2px solid #e2e8f0 !important;
      font-size: 0.9em !important;
      letter-spacing: 0.01em !important;
      text-transform: uppercase !important;
      font-size: 0.8em !important;
      color: #64748b !important;
    }
    .costumer-table-elegant tbody tr {
      border: none !important;
      background: #fff !important;
      transition: background 0.18s !important;
      min-height: 28px !important;
      height: 28px !important;
    }
    .costumer-table-elegant tbody tr:nth-child(even) {
      background-color: #f8fafc !important;
    }
    .costumer-table-elegant tbody tr:hover {
      background-color: #f1f5ff !important;
    }
    .costumer-table-elegant td {
      padding: 0.05px 1px !important;
      vertical-align: middle !important;
      border: none !important;
      font-size: 1em !important;
      color: #0a2540 !important;
      background: transparent !important;
      font-weight: 300 !important;
    }
    .costumer-table-elegant .badge-status {
      display: inline-block !important;
      padding: 5px 18px !important;
      border-radius: 16px !important;
      font-size: 1em !important;
      font-weight: 700 !important;
      background: #e3eaf5 !important;
      color: #1976d2 !important;
      border: none !important;
      letter-spacing: 0.04em !important;
      box-shadow: 0 1px 2px #1976d208 !important;
    }
    .costumer-table-elegant .badge-status-activo {
      background: #c8f7d8 !important;
      color: #219653 !important;
    }
    .costumer-table-elegant .badge-status-pendiente {
      background: #fff7e0 !important;
      color: #f2994a !important;
    }
    .costumer-table-elegant .badge-status-cancelado {
      background: #ffeaea !important;
      color: #e74c3c !important;
    }
    .costumer-table-elegant .badge-status-inactivo {
      background: #f3f3f3 !important;
      color: #bdbdbd !important;
    }
    .costumer-table-elegant .actions-cell {
      white-space: nowrap !important;
      text-align: right !important;
      padding-right: 8px !important;
    }
    .costumer-table-elegant .action-btn {
      background: none !important;
      border: 1px solid #e2e8f0 !important;
      color: #64748b !important;
      cursor: pointer !important;
      padding: 6px 10px !important;
      border-radius: 6px !important;
      margin: 0 2px !important;
      transition: all 0.15s ease !important;
      font-size: 0.9em !important;
      width: 32px !important;
      height: 32px !important;
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
    }
    .costumer-table-elegant .action-btn:hover {
      background-color: #f1f5ff !important;
      color: #1976d2 !important;
      transform: translateY(-1px) !important;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;
    }
    .costumer-table-elegant .action-btn.delete-btn:hover {
      color: #dc2626 !important;
      background-color: #fef2f2 !important;
      border-color: #fecaca !important;
    }
    .costumer-table-elegant .comentario-item {
      padding: 10px 0 !important;
      border-bottom: 1px solid #f0f0f0 !important;
      margin-bottom: 7px !important;
    }
    .costumer-table-elegant .comentario-item:last-child {
      border-bottom: none !important;
    }
    .costumer-table-elegant .comentario-meta {
      color: #1976d2 !important;
      font-size: 0.97em !important;
      margin-bottom: 2px !important;
      font-weight: 700 !important;
    }
    /* --- FIN ESTILO FORZADO --- */
    .costumer-table-container {
      width: 100%;
      overflow-x: auto;
      background: #fff;
      padding: 0;
      margin-bottom: 24px;
      border-radius: 14px 14px 0 0;
      box-shadow: 0 4px 24px #0001;
    }
    .costumer-table-elegant {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      color: #24334d;
      font-size: 1em;
      background: #fff;
      border-radius: 14px 14px 0 0;
      overflow: hidden;
    }
    .costumer-table-elegant thead th {
      position: sticky;
      top: 0;
      z-index: 10;
      background: #fff;
      color: #1976d2;
      font-weight: 700;
      padding: 17px 13px 15px 13px;
      text-align: left;
      border: none;
      border-bottom: 2px solid #e3eaf5;
      font-size: 1em;
      letter-spacing: 0.01em;
    }
    .costumer-table-elegant tbody tr {
      border: none;
      border-bottom: 1.5px solid #f0f3fa;
      background: #fff;
      transition: background 0.18s;
    }
    .costumer-table-elegant tbody tr:nth-child(even) {
      background: #f7fafd;
    }
    .costumer-table-elegant tbody tr:hover {
      background: #e3f0fd !important;
    }
    .costumer-table-elegant td {
      padding: 14px 16px !important;
      vertical-align: middle !important;
      color: #334155 !important;
      font-size: 0.92em !important;
      border: none !important;
      border-bottom: 1px solid #f1f5f9 !important;
      line-height: 1.4 !important;
    }
    .costumer-table-elegant .badge-status {
      display: inline-block;
      padding: 3px 14px;
      border-radius: 12px;
      font-size: 0.87em;
      font-weight: 600;
      background: #e3eaf5;
      color: #1976d2;
      letter-spacing: 0.03em;
      border: none;
    }
    .costumer-table-elegant .badge-status-activo {
      background: #e5f9ea;
      color: #219653;
    }
    .costumer-table-elegant .badge-status-pendiente {
      background: #fff7e0;
      color: #f2994a;
    }
    .costumer-table-elegant .badge-status-cancelado {
      background: #ffeaea;
      color: #e74c3c;
    }
    .costumer-table-elegant .badge-status-inactivo {
      background: #f3f3f3;
      color: #bdbdbd;
    }
    .costumer-table-elegant .costumer-action-btn {
      background: none;
      border: none;
      padding: 5px;
      margin: 0 2px;
      cursor: pointer;
      font-size: 1.1em;
      color: #b0b8c1;
      border-radius: 50%;
      transition: background 0.18s, color 0.18s;
    }
    .costumer-table-elegant .costumer-action-btn:hover {
      background: #e3eaf5;
      color: #1976d2;
    }
    .costumer-table-elegant .comentario-item {
      padding: 7px 0;
      border-bottom: 1px solid #f0f0f0;
      margin-bottom: 5px;
    }
    .costumer-table-elegant .comentario-item:last-child {
      border-bottom: none;
    }
    .costumer-table-elegant .comentario-meta {
      color: #1976d2;
      font-size: 0.88em;
      margin-bottom: 2px;
      font-weight: 500;
    }
    /* --- FIN ESTILO NOTORIO --- */

    /* Contenedor principal de la tabla */
    .costumer-table-container {
      width: 100%;
      overflow-x: auto;
      background: white;
      padding: 0;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
    }

    /* Tabla principal */
    .costumer-table-elegant {
      width: 100%;
      border-collapse: collapse;
      border-spacing: 0;
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      color: #333;
      font-size: 0.95em;
    }

    /* Cabecera de la tabla */
    .costumer-table-elegant thead th {
      position: sticky;
      top: 0;
      z-index: 10;
      background-color: #ffffff;
      color: #555;
      font-weight: 600;
      padding: 15px 12px;
      text-align: left;
      border: none;
      border-bottom: 1px solid #eaeaea;
      font-size: 0.9em;
      letter-spacing: 0.02em;
    }

    /* Filas del cuerpo de la tabla */
    .costumer-table-elegant tbody tr {
      border: none;
      border-bottom: 1px solid #f0f0f0;
      transition: background-color 0.15s ease;
    }

    /* Última fila sin borde inferior */
    .costumer-table-elegant tbody tr:last-child {
      border-bottom: none;
    }

    /* Hover sutil en las filas */
    .costumer-table-elegant tbody tr:hover {
      background-color: #f9fbfd;
    }

    /* Celdas de la tabla */
    .costumer-table-elegant td {
      padding: 12px;
      vertical-align: middle;
      border: none;
    }

    /* Badges de estado con diseño minimalista */
    .costumer-table-elegant .badge-status {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 0.85em;
      font-weight: 500;
      background: #f5f5f5;
      color: #555;
    }

    /* Estilos específicos para cada tipo de estado */
    .costumer-table-elegant .badge-status-activo {
      background-color: #e8f5e9;
      color: #2e7d32;
    }

    .costumer-table-elegant .badge-status-pendiente {
      background-color: #fff8e1;
      color: #f57c00;
    }

    .costumer-table-elegant .badge-status-cancelado {
      background-color: #ffebee;
      color: #c62828;
    }

    .costumer-table-elegant .badge-status-inactivo {
      background-color: #f5f5f5;
      color: #757575;
    }

    /* Tooltips minimalistas */
    .costumer-table-elegant .comentario-tooltip-minimal::after {
      content: attr(data-tooltip);
      position: absolute;
      left: 50%;
      top: 130%;
      transform: translateX(-50%);
      background: white;
      color: #333;
      border: 1px solid #eaeaea;
      border-radius: 4px;
      padding: 8px 12px;
      font-size: 0.9em;
      z-index: 20;
      min-width: 180px;
      max-width: 300px;
      pointer-events: none;
      white-space: pre-line;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .costumer-table-elegant .comentario-tooltip-minimal:hover::after {
      opacity: 1;
      visibility: visible;
      top: 120%;
    }

    /* Botones de acción minimalistas */
    .costumer-table-elegant .costumer-action-btn {
      background: none;
      border: none;
      padding: 6px;
      margin: 0 3px;
      cursor: pointer;
      font-size: 1em;
      color: #777;
      transition: color 0.15s ease;
    }

    .costumer-table-elegant .costumer-action-btn.edit:hover {
      color: #1976d2;
    }

    .costumer-table-elegant .costumer-action-btn.delete:hover {
      color: #e53935;
    }

    /* Panel de comentarios con estilo minimalista */
    .costumer-table-elegant .comentarios-panel {
      background: white;
      border-top: 1px solid #f0f0f0;
      padding: 15px 20px;
      margin: 0;
    }

    .costumer-table-elegant .comentario-item {
      padding: 8px 0;
      border-bottom: 1px solid #f0f0f0;
      margin-bottom: 6px;
    }

    .costumer-table-elegant .comentario-item:last-child {
      border-bottom: none;
    }

    .costumer-table-elegant .comentario-meta {
      color: #777;
      font-size: 0.85em;
      margin-bottom: 3px;
    }

    /* Formulario de nuevo comentario */
    .costumer-table-elegant .nuevo-comentario-form textarea {
      width: 100%;
      border: 1px solid #eaeaea;
      border-radius: 4px;
      padding: 8px 10px;
      font-size: 0.95em;
      resize: vertical;
      min-height: 60px;
      transition: border-color 0.15s ease;
    }

    .costumer-table-elegant .nuevo-comentario-form textarea:focus {
      border-color: #bbb;
      outline: none;
    }

    .costumer-table-elegant .nuevo-comentario-form button {
      background-color: #f5f5f5;
      color: #555;
      border: 1px solid #eaeaea;
      border-radius: 4px;
      padding: 6px 12px;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.15s ease;
      margin-top: 8px;
    }

    .costumer-table-elegant .nuevo-comentario-form button:hover {
      background-color: #e0e0e0;
    }

    :root {
      --primary: #4a90e2;
      --accent: #5c9ce6;
      --light: #e8f1fa;
      --dark: #2c5282;
      --text-color: #4a5568;
      --border-color: #e2e8f0;
      --background-color: #f7fafc;
      --text-main: #24334d;
      --gray-light: #f8fbff;
      --sidebar-bg: #fff;
      --sidebar-shadow: 2px 0 12px #0001;
      --border-radius: 16px;
      --card-shadow: 0 4px 20px #0002, 0 1.5px 3px #19b6f922;
    }
    html, body {height:100%;margin:0;padding:0;}
    body {
      background: var(--background-color);
      font-family:'Segoe UI', 'Roboto', 'Montserrat', Arial, sans-serif;
      min-height:100vh;
      color: var(--text-color);
      height: 100vh;
      overflow: hidden; padding-bottom: 32px;
  margin-bottom: 20px;
    }
    .topbar {
      background: var(--primary);
      color: #fff;
      padding: 0.9em 2em;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.11em;
      font-weight: 600;
      letter-spacing: 0.02em;
      box-shadow: 0 2px 10px #2196f320;
    }
    .topbar a.logout {
      color: #fff !important;
      font-weight: 700;
      text-decoration: none;
      transition: color 0.2s;
      border-bottom: 1.5px solid transparent;
    }
    .topbar a.logout:hover {
      color: #ffe082 !important;
      border-bottom: 1.5px solid #ffe082;
    }
    .container {
      display: flex;
      align-items: flex-start;
      width: 100vw;
      height: calc(100vh - 56px);
      min-height: 0;
      background: linear-gradient(90deg, #f8fbff 0%, #f6fafd 100%);
      overflow: hidden; padding-bottom: 32px;
  margin-bottom: 20px;
    }
    .sidebar {
      width: 230px;
      background: var(--sidebar-bg);
      height: 100%;
      border-radius: 0 18px 18px 0;
      box-shadow: var(--sidebar-shadow);
      padding: 2em 0.8em 2em 2em;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      font-size: 1.09em;
      font-weight: 500;
      z-index: 3;
      min-height: 0;
    }
    .sidebar h3 {
      font-size: 1.14em;
      margin-bottom: 1.5em;
      font-weight: 700;
      color: var(--primary);
      letter-spacing: 0.04em;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      width: 100%;
    }
    .sidebar li {margin: 1.2em 0;}
    .sidebar a {
      color: var(--primary);
      text-decoration: none;
      display: block;
      padding: 0.7em 1.2em;
      border-radius: 10px;
      transition: background 0.22s, color 0.22s, border-left 0.18s;
      font-weight: 700;
      width: 100%;
      box-sizing: border-box;
      letter-spacing: 0.03em;
    }
    .sidebar a.active, .sidebar a:focus {
      background: linear-gradient(90deg, #e3f2fd 0%, #e8f5ff 100%);
      color: var(--primary);
      border-left: 5px solid var(--accent);
      box-shadow:0 2px 8px #2196f922;
    }
    .main-content {
      flex: 1;
      min-width: 0;
      height: 100%;
      padding: 0 0 0 0.6em;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      min-height: 0;
      overflow: hidden; padding-bottom: 32px;
  margin-bottom: 20px;
    }
    .dashboard-flex-row {
      display: flex;
      flex-direction: row;
      gap: 2.5em;
      height: 100%;
      min-height: 0;
      align-items: flex-start;
    }
    /* Estilos del formulario movidos a crm-form-styles.css */
    .crm-form-section {
      max-width: 510px;
      width: 100%;
      align-self: flex-start;
      padding: 0;
      height: 100%;
      overflow-y: auto;
      scrollbar-width: thin;
    }
    .charts-section {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 1.5em;
      height: 100%;
    }
    .charts-filter {
      margin-bottom: 18px;
      padding: 13px 24px;
      background: #f8fbff;
      border-radius: 11px;
      border: 1px solid #e2e8f0;
      display: flex;
      align-items: center;
      gap: 18px;
      box-shadow: 0 2px 10px #2196f911;
    }
    .charts-filter label { font-weight: 700; margin-bottom: 0; color: var(--primary-dark);}
    .charts-filter input[type="date"] { padding: 8px 13px; border-radius: 8px; border: 1px solid #b4c5d4; font-size:1em;}
    .charts-filter button {
      background: var(--primary) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round' class='feather feather-bar-chart-2'%3E%3Cline x1='18' y1='20' x2='18' y2='10'/%3E%3Cline x1='12' y1='20' x2='12' y2='4'/%3E%3Cline x1='6' y1='20' x2='6' y2='14'/%3E%3C/svg%3E") no-repeat center center;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0;
      width: 38px;
      height: 38px;
      font-size: 0;
      cursor: pointer;
      transition: background .2s;
    }
    .charts-filter button:hover { background: var(--primary-dark); }
    .chart-container {
  min-height: 320px;
  padding: 10px 12px;
      background: #fff;
      padding: 22px 28px;
      border: 1px solid #e2e8f0;
      border-radius: 13px;
      box-shadow: 0 2px 10px #2196f911;
      flex: 1;
    }
    .no-data-msg { color: #d32f2f; font-weight: bold; text-align: center; margin-top: 10px;}
    .costumer-section { width: 100%; }
    .costumer-filters-elegant {
      background: #f8fbff;
      border-radius: 14px;
      border: 1.5px solid #e2e8f0;
      margin-bottom: 18px;
      box-shadow: 0 2px 8px #1976d211;
      padding: 18px 22px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px 20px;
    }
    .costumer-filter-input {
      padding: 10px 14px;
      border-radius: 9px;
      border: 1.5px solid #b4c5d4;
      font-size: 1.02em;
    }
    .costumer-btn-elegant {
      padding: 10px 22px;
      background: linear-gradient(90deg,#1976d2 60%,#2196f3 100%);
      color: #fff;
      border: none;
  font-size: 1.10em;
  border: none;
  border-radius: 999px !important;
  padding: 1.1em 1.5em;
  margin: 0 0.25em;
  box-shadow: 0 2px 10px #1976d222, 0 1.5px 6px #2196f911;
  letter-spacing: 0.01em;
  transition: background 0.18s, color 0.18s, box-shadow 0.18s;
  font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
}
.costumer-table-elegant {
  border-collapse: separate;
  border-spacing: 0;
  width: 100%;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 16px #1976d211;
  overflow: hidden; padding-bottom: 32px;
  margin-bottom: 20px;
}
.costumer-table-elegant thead th {
  position: sticky;
  top: 0;
  z-index: 2;
  background: linear-gradient(90deg, #1976d2 60%, #2196f3 100%);
  color: #fff;
  font-weight: 700;
  font-size: 1.08em;
  letter-spacing: 0.04em;
  border: none;
  padding: 13px 8px;
  text-align: left;
}
.costumer-table-elegant tbody tr {
  transition: background 0.18s;
  border: none;
}
.costumer-table-elegant tbody tr:nth-child(even) {
  background: #f8fbff;
}
.costumer-table-elegant tbody tr:hover {
  background: #e3f2fd !important;
}
.costumer-table-elegant td {
  border: none;
  padding: 11px 8px;
  font-size: 1.01em;
  color: #24334d;
  vertical-align: middle;
  word-break: break-word;
  max-width: 270px;
}
.costumer-table-elegant td.comentario {
  position: relative;
  cursor: pointer;
}
.costumer-table-elegant td.comentario:hover::after {
  content: attr(data-tooltip);
  position: absolute;
  left: 50%;
  top: 120%;
  transform: translateX(-50%);
  background: #fff;
  color: #24334d;
  border: 1px solid #b4c5d4;
  border-radius: 7px;
  padding: 10px 17px;
  box-shadow: 0 4px 16px #1976d211;
  font-size: 0.98em;
  z-index: 20;
  min-width: 180px;
  max-width: 350px;
  pointer-events: none;
  white-space: pre-line;
}
.costumer-table-elegant td, .costumer-table-elegant th {
  border-radius: 0 !important;
}
.costumer-table-elegant thead th:first-child {
  border-top-left-radius: 16px;
}
.costumer-table-elegant thead th:last-child {
  border-top-right-radius: 16px;
}
.costumer-table-elegant tbody tr:last-child td:first-child {
  border-bottom-left-radius: 16px;
}
.costumer-table-elegant tbody tr:last-child td:last-child {
  border-bottom-right-radius: 16px;
}
.costumer-table-elegant .agrupador-dia {
  background: #e3f2fd;
  font-weight: bold;
  color: #1976d2;
  font-size: 1.04em;
  letter-spacing: 0.03em;
  border-top: 2px solid #b4c5d4;
  border-bottom: 2px solid #b4c5d4;
}

.costumer-table-elegant .comentario-btn-minimal, .costumer-table-elegant .acciones-btn-minimal {
  background: none; border: none; color: #1976d2; font-size: 1.05em; padding: 5px 7px; border-radius: 7px;
  transition: background 0.18s, color 0.18s;
  margin-right: 3px;
  cursor: pointer;
}
.costumer-table-elegant .comentario-btn-minimal:hover, .costumer-table-elegant .acciones-btn-minimal:hover { background: #e3f2fd; color: #0d47a1; }
.costumer-table-elegant .acciones-btn-minimal.borrar { color: #e53935; }
.costumer-table-elegant .acciones-btn-minimal.borrar:hover { background: #ffebee; color: #b71c1c; }
.costumer-table-elegant .comentario-tooltip-minimal { margin-left:5px; color:#1976d2; cursor:pointer; position:relative; }
.costumer-table-elegant .comentario-tooltip-minimal:hover::after {
  content: attr(data-tooltip);
  white-space: pre-line;
  position: absolute;
  left: 50%;
  top: 120%;
  transform: translateX(-50%);
  background: #fff;
  color: #24334d;
  border: 1px solid #b4c5d4;
  border-radius: 7px;
  padding: 10px 17px;
  box-shadow: 0 4px 16px #1976d211;
  font-size: 0.98em;
  z-index: 20;
  min-width: 180px;
  max-width: 350px;
  pointer-events: none;
}


.costumer-table-elegant thead th {
  background: #5b8db8;
  color: #fff;
  font-weight: 700;
  font-size: 1.09em;
  border: none;
  padding: 1.05em 0.7em;
  text-align: center;
  box-shadow: 0 2px 8px #0001;
  letter-spacing: 0.01em;
  font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
  position: sticky;
  top: 0;
  z-index: 2;
  transition: background 0.16s, color 0.16s;
}
.costumer-table-elegant thead th:first-child {
  border-top-left-radius: 11px;
}
.costumer-table-elegant thead th:last-child {
  border-top-right-radius: 11px;
}
.costumer-table-elegant thead tr {
  display: table-row;
}
.costumer-table-elegant tbody tr {
  transition: background 0.18s;
}
.costumer-table-elegant tbody tr:nth-child(even) {
  background: #f2f6fa;
}
.costumer-table-elegant tbody tr:nth-child(odd) {
  background: #fff;
}
.costumer-table-elegant tbody tr:hover {
  background: #e3f1fd;
  cursor: pointer;
}
.costumer-table-elegant td, .costumer-table-elegant th {
  padding: 10px 12px;
  border-radius: 7px;
}
.costumer-table-elegant td {
  border-bottom: 1px solid #e3e9f3;
  font-size: 0.99em;
}
.costumer-filters-elegant {
  background: #f8fbff;
  border-radius: 14px;
  border: 1.5px solid #e2e8f0;
  margin-bottom: 18px;
  box-shadow: 0 2px 8px #1976d211;
  padding: 18px 22px 10px 22px;
  display: flex;
  flex-wrap: wrap;
  gap: 12px 20px;
}
.costumer-filter-input {
  border-radius: 7px;
  border: 1.5px solid #b4c5d4;
  padding: 9px 13px;
  font-size: 1em;
  background: #fafdff;
  transition: border 0.15s;
  color: var(--text-main);
  min-width: 180px;
}
.costumer-filter-input:focus {
  outline: 2px solid var(--primary);
  border-color: var(--primary);
  background: #eaf6ff;
}
.costumer-btn-elegant {
  padding: 10px 22px;
  background: linear-gradient(90deg,#1976d2 60%,#2196f3 100%);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-weight: 700;
  cursor: pointer;
  font-size: 1.04em;
  box-shadow: 0 2px 8px #1976d211;
  transition: background 0.22s, box-shadow 0.18s;
}
.costumer-btn-elegant:hover {
  background: #1976d2;
  box-shadow: 0 4px 16px #1976d222;
}
.costumer-btn-clear {
  background: #eaf4fb !important;
  color: var(--primary) !important;
  border: 1.5px solid #b4c5d4 !important;
}
.costumer-btn-clear:hover {
  background: #dbefff !important;
  color: #1976d2 !important;
}
@media (max-width: 1200px) {
  .dashboard-flex-row {flex-direction:column; height:auto;}
  .crm-form-section{max-width:100%;margin-bottom:2.2em; height:auto; max-height:none; min-height:0;}
  .charts-section{min-width:0;}
  .costumer-table-elegant {min-width: 900px;}
}
html, body, .container, .main-content, .dashboard-flex-row, .crm-form-section, .charts-section {
  min-height: 0 !important;
}
/* Se agregó la llave de cierre faltante */

    .costumer-table {
      border-collapse:separate;
      border-spacing:0;
      width:100%;
      min-width:1350px;
      font-size: 1.01em;
    }
    .costumer-table thead th {
      background: #2196f3;
      color: #fff;
      font-weight: 800;
      font-size: 1.10em;
      border-bottom: 2px solid #1976d2;
      text-align: left;
      position: sticky;
    .costumer-table-wrapper::-webkit-scrollbar {
      height: 8px;
      background: #e3f2fd;
      border-radius: 8px;
    }
    .costumer-table-wrapper::-webkit-scrollbar-thumb {
      background: #b3e0ff;
      border-radius: 8px;
    }
    @media (max-width: 1200px) {
      .dashboard-flex-row {flex-direction:column; height:auto;}
      .crm-form-section{max-width:100%;margin-bottom:2.2em; height:auto; max-height:none; min-height:0;}
      .charts-section{min-width:0;}
    }
    html, body, .container, .main-content, .dashboard-flex-row, .crm-form-section, .charts-section {
      min-height: 0 !important;
    }
    /* Se agregó la llave de cierre faltante */
  }
  .td-ellipsis {
  max-width: 140px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  vertical-align: middle;
  cursor: pointer;
}
.td-nowrap {
  white-space: nowrap;
  vertical-align: middle;
}
.costumer-table-elegant th, .costumer-table-elegant td {
  text-align: center;
  vertical-align: middle;
  padding: 7px 9px;
  border-bottom: 1.5px solid #d5e4f3;
  border-right: 1px solid #e3e9f3;
}
.costumer-table-elegant th {
  position: sticky;
  top: 0;
  background: #5b8db8;
  z-index: 2;
}
.costumer-table-elegant tbody tr:nth-child(even) {
  background: #f5f9fc;
}
.costumer-table-elegant tbody tr:nth-child(odd) {
  background: #fff;
}
.costumer-table-elegant tbody tr:hover {
  background: #e3f1fd;
}
.costumer-table-wrapper {
  overflow-x: auto;
  min-width: 900px;
}
</style>
  <link rel="stylesheet" href="css/costumer-table-clean.css">
  <link rel="stylesheet" href="css/costumer-table-actions.css">
  <link rel="stylesheet" href="css/costumer-table-comments.css">
</head>
<body>
  <div class="topbar">
    <div style="display:flex;align-items:center;gap:12px;">
      <i class="fas fa-user-tie" style="font-size:1.25em;color:#fff;margin-right:6px;"></i>
      <b>CRM Agente</b>
    </div>
    <a href="#" class="logout"><i class="fas fa-sign-out-alt"></i> Cerrar sesión</a>
  </div>
  <div class="container">
    <div class="sidebar">
      <h3>Menú</h3>
      <ul>
        <li><a href="#" class="tab-btn" data-tab="inicioTab" id="tabInicio"><i class="fas fa-home"></i> Inicio</a></li>
        <li><a href="#" class="tab-btn" data-tab="leadTab" id="tabLead"><i class="fas fa-user-plus"></i> Lead</a></li>

        <li><a href="#" class="tab-btn" data-tab="costumerTab" id="tabCostumer"><i class="fas fa-users"></i> Costumer</a></li>
      </ul>
    </div>
    <div class="main-content">
      <!-- SECCIÓN INICIO -->
      <div class="inicio-section" id="inicioTab" style="display: flex; align-items: center; justify-content: center; height: 80vh; width: 100%;">
        <div style="text-align:center;">
          <i class="fas fa-tools" style="font-size:3.5em;color:#1976d2;margin-bottom:18px;"></i>
          <h1 style="font-size:2.2em;color:#1976d2;margin-bottom:10px;">En construcción</h1>
          <div style="font-size:1.3em;color:#888;">By Zombie</div>
        </div>
      </div>
      <div class="dashboard-flex-row" id="leadTab">

        <!-- FORMULARIO LEAD -->
        <section class="crm-form-section" id="form-panel">
          <!-- Cabecera del formulario -->
          <div class="form-header">
            <h2><i class="fas fa-user-edit"></i> Formulario de Registro</h2>
            <button type="button" class="close-btn" id="close-form-btn">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <!-- Contenedor del formulario -->
          <div class="form-container">
            <form id="lead-form" class="crm-form" autocomplete="off" novalidate>
            <!-- AQUÍ VAN TODOS TUS CAMPOS DE FORMULARIO -->
            <h3 class="form-section-title"><i class="fas fa-user-circle"></i> Información del Cliente</h3>
            <div class="crm-form-group required" data-field="nombre_cliente">
              <label class="crm-form-label"><i class="fas fa-user"></i> Nombre cliente <span class="crm-form-req">*</span></label>
              <input type="text" name="nombre_cliente" class="crm-form-input" placeholder="Ej: Juan Pérez" required />
            </div>
            
            <div class="form-row">
              <div class="crm-form-group required" data-field="telefono_principal">
                <label class="crm-form-label"><i class="fas fa-phone"></i> Teléfono principal <span class="crm-form-req">*</span></label>
                <input type="text" name="telefono_principal" class="crm-form-input" placeholder="Tu respuesta" required />
              </div>
              <div class="crm-form-group" data-field="telefono_alterno">
                <label class="crm-form-label"><i class="fas fa-phone-alt"></i> Teléfono Alterno</label>
                <input type="text" name="telefono_alterno" class="crm-form-input" placeholder="Tu respuesta" />
              </div>
            </div>
            
            <div class="form-row">
              <div class="crm-form-group required" data-field="numero_cuenta">
                <label class="crm-form-label"><i class="fas fa-id-card"></i> Número de cuenta <span class="crm-form-req">*</span></label>
                <input type="text" name="numero_cuenta" class="crm-form-input" placeholder="Tu respuesta" required />
              </div>
              <div class="crm-form-group required" data-field="autopago">
                <label class="crm-form-label"><i class="fas fa-credit-card"></i> Autopago <span class="crm-form-req">*</span></label>
                <select name="autopago" class="crm-form-select" required>
                  <option value="">Elige</option>
                  <option value="SI">SI</option>
                  <option value="NO">NO</option>
                </select>
              </div>
            </div>
            
            <div class="crm-form-group required" data-field="direccion">
              <label class="crm-form-label"><i class="fas fa-map-marker-alt"></i> Dirección <span class="crm-form-req">*</span></label>
              <input type="text" name="direccion" class="crm-form-input" placeholder="Tu respuesta" required />
            </div>
            <h3 class="form-section-title"><i class="fas fa-cogs"></i> Información del Servicio</h3>
            <div class="crm-form-group required" data-field="tipo_servicios">
              <label class="crm-form-label"><i class="fas fa-list-alt"></i> Tipo de servicios <span class="crm-form-req">*</span></label>
              <select name="tipo_servicios" class="crm-form-select" required>
                <option value="">Elige</option>
                <option value="AT&T AIR">AT&T AIR</option>
                <option value="AT&T INTERNET 1 GIGA O MAS">AT&T INTERNET 1 GIGA O MAS</option>
                <option value="AT&T INTERNET DE 500 MBPS">AT&T INTERNET DE 500 MBPS</option>
                <option value="AT&T INTERNET DE 300 MBPS">AT&T INTERNET DE 300 MBPS</option>
                <option value="AT&T INTERNET DE 100 MBPS">AT&T INTERNET DE 100 MBPS</option>
                <option value="AT&T INTERNET DE 50 Y 75 MBPS">AT&T INTERNET DE 50 Y 75 MBPS</option>
                <option value="AT&T INTERNET MENOS DE 50">AT&T INTERNET MENOS DE 50</option>
                <option value="FRONTIER 7 GIG">FRONTIER 7 GIG</option>
                <option value="FRONTIER 5 GIG">FRONTIER 5 GIG</option>
                <option value="FRONTIER 2 GIG">FRONTIER 2 GIG</option>
                <option value="FRONTIER 1 GIG">FRONTIER 1 GIG</option>
                <option value="FRONTIER 500 MBPS">FRONTIER 500 MBPS</option>
                <option value="FRONTIER UNDER 500 MBPS">FRONTIER UNDER 500 MBPS</option>
                <option value="UNLIMITED DIGITAL VOICE">UNLIMITED DIGITAL VOICE</option>
                <option value="Centurylink/Lumen 900MBPS+">Centurylink/Lumen 900MBPS+</option>
                <option value="Centurylink/Lumen 100-899MBPS">Centurylink/Lumen 100-899MBPS</option>
                <option value="Centurylink/Lumen 10-99MBPS">Centurylink/Lumen 10-99MBPS</option>
                <option value="Ziply Fiber 10GIG">Ziply Fiber 10GIG</option>
                <option value="Ziply Fiber 5GIG">Ziply Fiber 5GIG</option>
                <option value="Ziply Fiber 2GIG">Ziply Fiber 2GIG</option>
                <option value="Ziply Fiber 1GIG">Ziply Fiber 1GIG</option>
                <option value="Ziply Fiber 300/300">Ziply Fiber 300/300</option>
                <option value="Ziply Fiber 200/200">Ziply Fiber 200/200</option>
                <option value="SPECTRUM 2 GIGA">SPECTRUM 2 GIGA</option>
                <option value="SPECTRUM 1 GIGA">SPECTRUM 1 GIGA</option>
                <option value="SPECTRUM PREMIER">SPECTRUM PREMIER</option>
                <option value="SPECTRUM ADVANTAGE">SPECTRUM ADVANTAGE</option>
                <option value="SPECTRUM 500MBPS">SPECTRUM 500MBPS</option>
                <option value="SPECTRUM 400 MBPS">SPECTRUM 400 MBPS</option>
                <option value="WOW! 1200MBPS">WOW! 1200MBPS</option>
                <option value="WOW! 1000MBPS">WOW! 1000MBPS</option>
                <option value="WOW! 500MBPS">WOW! 500MBPS</option>
                <option value="WOW! 200MBPS">WOW! 200MBPS</option>
                <option value="OPTIMUM BROADBAND 5 GBPS">OPTIMUM BROADBAND 5 GBPS</option>
                <option value="OPTIMUM BROADBAND 2 GBPS">OPTIMUM BROADBAND 2 GBPS</option>
                <option value="OPTIMUM BROADBAND 1 GBPS">OPTIMUM BROADBAND 1 GBPS</option>
                <option value="OPTIMUM BROADBAND 500 MBPS">OPTIMUM BROADBAND 500 MBPS</option>
                <option value="VIVINT">VIVINT</option>
                <option value="VIDEO SELECT">VIDEO SELECT</option>
                <option value="ADDITIONAL DOUBLE PLAY">ADDITIONAL DOUBLE PLAY</option>
                <option value="ADDITIONAL TRIPLE PLAY">ADDITIONAL TRIPLE PLAY</option>
                <option value="INTERNET">INTERNET</option>
                <option value="DIRECTV VIA INTERNET">DIRECTV VIA INTERNET</option>
                <option value="DIRECTV VIA SATELITE">DIRECTV VIA SATELITE</option>
                <!-- ...agrega los productos que falten... -->
              </select>
            </div>
            
            <div class="form-row">
              <div class="crm-form-group required" data-field="sistema">
                <label class="crm-form-label"><i class="fas fa-server"></i> Sistema <span class="crm-form-req">*</span></label>
                <select name="sistema" class="crm-form-select" required>
                  <option value="">Elige</option>
                  <option value="sistema1">SARA </option>
                  <option value="sistema2">OPUS</option>
                  <option value="Sistema3"> B.O</option>
                  <option value="Sistema4">N.A</option>
                  <option value="Sistema5">CHUZO</option>
                </select>
              </div>
              <div class="crm-form-group required" data-field="riesgo">
                <label class="crm-form-label"><i class="fas fa-exclamation-triangle"></i> Riesgo <span class="crm-form-req">*</span></label>
                <select name="riesgo" class="crm-form-select" required>
                  <option value="">Elige</option>
                  <option value="LOW">LOW</option>
                  <option value="MEDIUM">MEDIUM</option>
                  <option value="HIGH">HIGH</option>
                  <option value="N/A">N/A</option>
                </select>
              </div>
            </div>
            
            <div class="form-row">
              <div class="crm-form-group required" data-field="dia_venta">
                <label class="crm-form-label"><i class="fas fa-calendar-check"></i> Día de venta <span class="crm-form-req">*</span></label>
                <input type="date" name="dia_venta" class="crm-form-input" required />
              </div>
              <div class="crm-form-group required" data-field="dia_instalacion">
                <label class="crm-form-label"><i class="fas fa-tools"></i> Día de instalación <span class="crm-form-req">*</span></label>
                <input type="date" name="dia_instalacion" class="crm-form-input" required />
              </div>
            </div>
            <h3 class="form-section-title"><i class="fas fa-clipboard-check"></i> Estado y Detalles</h3>
            <div class="form-row">
              <div class="crm-form-group required" data-field="status">
                <label class="crm-form-label"><i class="fas fa-tag"></i> Status <span class="crm-form-req">*</span></label>
                <select name="status" class="crm-form-select" required>
                  <option value="">Elige</option>
                  <option value="VENTA">VENTA</option>
                  <option value="INSTALADO">INSTALADO</option>
                  <option value="CANCELADO">CANCELADO</option>
                  <option value="NO INSTALADO">NO INSTALADO</option>
                  <option value="PENDIENTE">PENDIENTE</option>
                  <option value="REAGENDADO">REAGENDADO</option>
                </select>
              </div>
              <div class="crm-form-group required" data-field="servicios">
                <label class="crm-form-label"><i class="fas fa-concierge-bell"></i> Servicios <span class="crm-form-req">*</span></label>
                <select name="servicios" class="crm-form-select" required>
                  <option value="">Elige</option>
                  <option value="INTERNET">INTERNET</option>
                  <option value="INTERNET + TELEFONO">INTERNET + TELEFONO</option>
                  <option value="INTERNET + TV">INTERNET + TV</option>
                  <option value="INTERNET + TELEFONO + TV">INTERNET + TELEFONO + TV</option>
                  <option value="TELEFONO">TELEFONO</option>
                  <option value="TV">TV</option>
                  <option value="TELEFONO + TV">TELEFONO + TV</option>
                  <option value="SEGURIDAD">SEGURIDAD</option>
                  <option value="INTERNET + SEGURIDAD">INTERNET + SEGURIDAD</option>
                  <option value="INTERNET + TELEFONO + SEGURIDAD">INTERNET + TELEFONO + SEGURIDAD</option>
                  <option value="INTERNET + TV + SEGURIDAD">INTERNET + TV + SEGURIDAD</option>
                  <option value="INTERNET + TELEFONO + TV + SEGURIDAD">INTERNET + TELEFONO + TV + SEGURIDAD</option>
                  <option value="TELEFONO + SEGURIDAD">TELEFONO + SEGURIDAD</option>
                  <option value="TV + SEGURIDAD">TV + SEGURIDAD</option>
                  <option value="TELEFONO + TV + SEGURIDAD">TELEFONO + TV + SEGURIDAD</option>
                </select>
              </div>
            </div>
            
            <div class="crm-form-group required" data-field="mercado">
              <label class="crm-form-label"><i class="fas fa-map"></i> Mercado <span class="crm-form-req">*</span></label>
              <select name="mercado" class="crm-form-select" required>
                <option value="">Elige</option>
                <option value="ICON">ICON</option>
                <option value="BAMO">BAMO</option>
              </select>
            </div>
            <h3 class="form-section-title"><i class="fas fa-user-tie"></i> Supervisión y Seguimiento</h3>
            <div class="form-row">
              <div class="crm-form-group required" data-field="supervisor">
                <label class="crm-form-label"><i class="fas fa-user-shield"></i> Supervisor <span class="crm-form-req">*</span></label>
                <select name="supervisor" class="crm-form-select" required>
                  <option value="">Elige</option>
                  <option value="IRANIA">IRANIA</option>
                  <option value="ROBERTO">ROBERTO</option>
                  <option value="MARISOL">MARISOL</option>
                  <option value="PLEITEZ">PLEITEZ</option>
                  <option value="RANDAL">RANDAL</option>
                  <option value="JONATHAN">JONATHAN</option>
                </select>
              </div>
              <div class="crm-form-group required" data-field="comentario">
                <label class="crm-form-label"><i class="fas fa-comment-alt"></i> Comentario <span class="crm-form-req">*</span></label>
                <select name="comentario" class="crm-form-select" required>
                  <option value="">Elige</option>
                  <option value="ADQUIRIR SERVICIOS">ADQUIRIR SERVICIOS</option>
                  <option value="CANCELAR SERVICIO ANTERIOR">CANCELAR SERVICIO ANTERIOR</option>
                  <option value="QUITAR FEE $99.00">QUITAR FEE $99.00</option>
                  <option value="CREAR ORDEN DE INTERNET">CREAR ORDEN DE INTERNET</option>
                </select>
              </div>
            </div>
            
            <div class="crm-form-group required" data-field="motivo_llamada">
              <label class="crm-form-label"><i class="fas fa-phone-volume"></i> ¿Por qué llamó el cliente? <span class="crm-form-req">*</span></label>
              <div class="crm-form-radio-group radio-grid">
                <label class="crm-form-radio-label"><input type="radio" class="crm-form-radio-input" name="motivo_llamada" value="FACTURACION_BILL" required> FACTURACIÓN / BILL</label>
                <label class="crm-form-radio-label"><input type="radio" class="crm-form-radio-input" name="motivo_llamada" value="PROBLEMAS_INTERNET"> PROBLEMAS DE INTERNET</label>
                <label class="crm-form-radio-label"><input type="radio" class="crm-form-radio-input" name="motivo_llamada" value="ADQUIRIR_SERVICIOS"> ADQUIRIR SERVICIOS</label>
                <label class="crm-form-radio-label"><input type="radio" class="crm-form-radio-input" name="motivo_llamada" value="MUDANZA"> MUDANZA</label>
                <label class="crm-form-radio-label"><input type="radio" class="crm-form-radio-input" name="motivo_llamada" value="CANCELAR_SERVICIOS"> CANCELAR SERVICIOS</label>
                <label class="crm-form-radio-label"><input type="radio" class="crm-form-radio-input" name="motivo_llamada" value="ATENCION_CLIENTE"> ATENCIÓN AL CLIENTE</label>
              </div>
            </div>
            
            <div class="form-row">
              <div class="crm-form-group required" data-field="zip_code">
                <label class="crm-form-label"><i class="fas fa-map-pin"></i> ZIP CODE <span class="crm-form-req">*</span></label>
                <input type="text" name="zip_code" class="crm-form-input" placeholder="Tu respuesta" required />
              </div>
              <div class="crm-form-group required" data-field="puntaje">
                <label class="crm-form-label"><i class="fas fa-star"></i> Puntaje <span class="crm-form-req">*</span></label>
                <select name="puntaje" class="crm-form-select" required>
                  <option value="">Elige</option>
                  <option value="0.35">0.35</option>
                  <option value="1.50">1.50</option>
                  <option value="1.0">1.0</option>
                  <option value="0.25">0.25</option>
                </select>
              </div>
            </div>
            <div class="form-actions">
              <button type="submit" class="crm-form-submit-btn">
                <i class="fas fa-save"></i> Guardar Lead
              </button>
            </div>
          </form>
          </div> <!-- Cierre de .form-container -->
          <script src="js/core/script.js"></script>
          <script src="js/core/form-handler.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
          <script src="js/core/graficas.js"></script>
          <script src="js/core/dashboard-stats.js"></script>
        </section>
        <!-- SECCIÓN DE GRÁFICAS -->
        <section class="charts-section" id="charts-panel">
          <div class="charts-filter">
            <label for="fechaGraficas"><i class="fas fa-filter"></i> Filtrar gráficas por fecha:</label>
            <input type="date" id="fechaGraficas" />
            <button type="button"><i class="fas fa-chart-bar"></i> Ver gráficas</button>
          </div>
          <div class="chart-container">
            <canvas id="ventasTeamChart" class="chart-canvas"></canvas>
            <div id="no-data-team" class="no-data-msg" style="display:none">No hay datos para esta fecha</div>
          </div>
          <div class="chart-container">
            <canvas id="productosChart" class="chart-canvas"></canvas>
            <div id="no-data-producto" class="no-data-msg" style="display:none">No hay datos para esta fecha</div>
          </div>
        </section>
      </div>
      <!-- SECCIÓN COSTUMER -->
      <div class="costumer-section" id="costumerTab" style="display: none; margin-top:2em;">
        <!-- ESTILOS PARA LAS TARJETAS DE RESUMEN -->
        <style>
          .summary-cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 2.5rem;
            width: 100%;
          }
          
          .summary-card {
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            padding: 1.5rem 1.5rem 1.8rem;
            transition: all 0.3s ease;
            border: 1px solid #e9edf4;
            position: relative;
            overflow: hidden;
          }
          
          .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
          }
          
          .summary-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
          }
          
          .summary-card.sales-today::before { background: linear-gradient(135deg, #4caf50, #66bb6a); }
          .summary-card.pending-clients::before { background: linear-gradient(135deg, #ff9800, #ffa726); }
          .summary-card.canceled-sales::before { background: linear-gradient(135deg, #f44336, #ef5350); }
          .summary-card.monthly-sales::before { background: linear-gradient(135deg, #2196f3, #42a5f5); }
          
          .card-content {
            display: flex;
            flex-direction: column;
            height: 100%;
          }
          
          .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
          }
          
          .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            font-size: 1.5rem;
            color: white;
          }
          
          .card-title {
            font-size: 1rem;
            font-weight: 500;
            color: #5a6a85;
            margin: 0;
            line-height: 1.4;
          }
          
          .card-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #2c3e50;
            margin: 0.5rem 0 0.2rem;
            line-height: 1.2;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
          }
          
          .card-footer {
            margin-top: auto;
            font-size: 0.8rem;
            color: #7f8c9a;
            display: flex;
            align-items: center;
          }
          
          .card-footer i {
            margin-right: 4px;
            font-size: 0.9em;
          }
          
          @media (max-width: 1200px) {
            .summary-cards-container {
              grid-template-columns: repeat(2, 1fr);
            }
          }
          
          @media (max-width: 768px) {
            .summary-cards-container {
              grid-template-columns: 1fr;
            }
          }
        </style>
        
        <div class="summary-cards-container">
          <!-- Ventas Hoy -->
          <div class="summary-card sales-today">
            <div class="card-content">
              <div class="card-header">
                <div class="card-icon" style="background: linear-gradient(135deg, #4caf50, #66bb6a);">
                  <i class="fas fa-shopping-cart"></i>
                </div>
                <h3 class="card-title">Ventas Hoy</h3>
              </div>
              <div class="card-value" id="costumer-ventas-hoy">0</div>
              <div class="card-footer">
                <i class="fas fa-calendar-day"></i> Actualizado ahora
              </div>
            </div>
          </div>
          
          <!-- Clientes Pendientes -->
          <div class="summary-card pending-clients">
            <div class="card-content">
              <div class="card-header">
                <div class="card-icon" style="background: linear-gradient(135deg, #ff9800, #ffa726);">
                  <i class="fas fa-user-clock"></i>
                </div>
                <h3 class="card-title">Clientes Pendientes</h3>
              </div>
              <div class="card-value" id="costumer-clientes-pendientes">0</div>
              <div class="card-footer">
                <i class="fas fa-info-circle"></i> Pendientes de seguimiento
              </div>
            </div>
          </div>
          
          <!-- Ventas Canceladas -->
          <div class="summary-card canceled-sales">
            <div class="card-content">
              <div class="card-header">
                <div class="card-icon" style="background: linear-gradient(135deg, #f44336, #ef5350);">
                  <i class="fas fa-times-circle"></i>
                </div>
                <h3 class="card-title">Ventas Canceladas</h3>
              </div>
              <div class="card-value" id="costumer-ventas-canceladas">0</div>
              <div class="card-footer">
                <i class="fas fa-exclamation-triangle"></i> Requieren revisión
              </div>
            </div>
          </div>
          
          <!-- Ventas del Mes -->
          <div class="summary-card monthly-sales">
            <div class="card-content">
              <div class="card-header">
                <div class="card-icon" style="background: linear-gradient(135deg, #2196f3, #42a5f5);">
                  <i class="fas fa-chart-line"></i>
                </div>
                <h3 class="card-title">Ventas del Mes</h3>
              </div>
              <div class="card-value" id="costumer-ventas-mes">0</div>
              <div class="card-footer">
                <i class="fas fa-calendar-alt"></i> Mes en curso
              </div>
            </div>
          </div>
        </div>
        
        <button class='comentarios-btn' style='font-size:1.3em;margin-bottom:10px;'><i class="fas fa-comment-dots"></i> Prueba botón comentario</button>
        <div class="costumer-table-wrapper costumer-table-container" style="overflow-x:auto; min-width:900px;">
          <table class="costumer-table costumer-table-clean costumer-table-elegant" style="width:100%;table-layout:auto;">
            <thead>
              <tr>
                <th>Nombre cliente</th>
                <th>Teléfono principal</th>
                <th>Teléfono alterno</th>
                <th>Numero de cuenta</th>
                <th>Autopago</th>
                <th>Dirección</th>
                <th>Tipo de servicios</th>
                <th>Sistema</th>
                <th>Riesgo</th>
                <th>Dia de venta</th>
                <th>Dia de instalación</th>
                <th>Status</th>
                <th>Servicios</th>
                <th>Mercado</th>
                <th>Supervisor</th>
                <th>Comentario</th>
                <th>Motivo llamada</th>
                <th>ZIP CODE</th>
                <th>Puntaje</th>
           <th style="min-width:130px;">Comentarios sobre la venta</th>
           <th style="min-width:90px;">Acción</th>
         </tr>
       </thead>
      <tbody id="costumer-tbody">
        <!-- filas se llenan dinámicamente -->
      </tbody>
    </table>
  </div>
</div>

      </div>
    </div>
  </div>
  <script>
    // USUARIO DEMO (puedes cambiar esto desde backend o login)
    const usuario_actual = {
      nombre: "Jose",
      rol: "agente"
    };

    // Lógica de puntaje por producto/riesgo
    function obtenerPuntaje(producto, riesgo) {
      // DIRECTV lógica especial
      if (/DIRECTV/i.test(producto)) {
        if (riesgo === "LOW") return 1.00;
        if (riesgo === "MEDIUM") return 0.35;
        return 0;
      }
      // SPECTRUM 500MBPS o 400MBPS lógica especial
      if (/SPECTRUM\s?500\s?MBPS/i.test(producto) || /SPECTRUM\s?400\s?MBPS/i.test(producto)) {
        return 1.00;
      }
      // Tabla de productos (exacto)
      const puntajes = {
        // AT&T
        "AT&T AIR": 0.35,
        "AT&T INTERNET 1 GIGA O MAS": 1.50,
        "AT&T INTERNET DE 500 MBPS": 1.25,
        "AT&T INTERNET DE 300 MBPS": 1.25,
        "AT&T INTERNET DE 100 MBPS": 1.00,
        "AT&T INTERNET DE 50 Y 75 MBPS": 0.35,
        "AT&T INTERNET MENOS DE 50": 0.25,
        // FRONTIER
        "FRONTIER 7 GIG": 1.50,
        "FRONTIER 5 GIG": 1.50,
        "FRONTIER 2 GIG": 1.25,
        "FRONTIER 1 GIG": 1.25,
        "FRONTIER 500 MBPS": 1.00,
        "FRONTIER UNDER 500 MBPS": 0.35,
        "UNLIMITED DIGITAL VOICE": 0.35,
        // CenturyLink/Lumen
        "Centurylink/Lumen 900MBPS+": 1.00,
        "Centurylink/Lumen 100-899MBPS": 0.75,
        "Centurylink/Lumen 10-99MBPS": 0.25,
        // Ziply Fiber
        "Ziply Fiber 10GIG": 1.25,
        "Ziply Fiber 5GIG": 1.25,
        "Ziply Fiber 2GIG": 1.00,
        "Ziply Fiber 1GIG": 1.00,
        "Ziply Fiber 300/300": 0.35,
        "Ziply Fiber 200/200": 0.35,
        // SPECTRUM
        "SPECTRUM 2 GIGA": 1.25,
        "SPECTRUM 1 GIGA": 1.00,
        "SPECTRUM PREMIER": 1.00,
        "SPECTRUM ADVANTAGE": 0.35,
        // WOW!
        "WOW! 1200MBPS": 0.35,
        "WOW! 1000MBPS": 0.35,
        "WOW! 500MBPS": 0.25,
        "WOW! 200MBPS": 0.25,
        // OPTIMUM
        "OPTIMUM BROADBAND 5 GBPS": 1.25,
        "OPTIMUM BROADBAND 2 GBPS": 1.25,
        "OPTIMUM BROADBAND 1 GBPS": 1.00,
        "OPTIMUM BROADBAND 500 MBPS": 0.35,
        // VIVINT & VIDEO
        "VIVINT": 0,
        "VIDEO SELECT": 0.35,
        "ADDITIONAL DOUBLE PLAY": 0.25,
        "ADDITIONAL TRIPLE PLAY": 0.35,
        // Otros
        "INTERNET": 1.00
      };
      if (puntajes[producto]) return puntajes[producto];

      // Si no match exacto, intenta por contiene
      for (let key in puntajes) {
        if (producto.toLowerCase().includes(key.toLowerCase())) {
          return puntajes[key];
        }
      }
      return 0;
    }

    document.addEventListener('DOMContentLoaded', function() {
      // Estado inicial: solo Inicio visible
      document.getElementById('inicioTab').style.display = 'flex';
      document.getElementById('leadTab').style.display = 'none';
      document.getElementById('costumerTab').style.display = 'none';
      document.getElementById('tabInicio').classList.add('active');
      document.getElementById('tabLead').classList.remove('active');
      document.getElementById('tabCostumer').classList.remove('active');
      // TAB FUNCIONALIDAD
      document.getElementById("tabInicio").addEventListener('click', function(e){
        e.preventDefault();
        document.getElementById('inicioTab').style.display = 'flex';
        document.getElementById('leadTab').style.display = 'none';
        document.getElementById('costumerTab').style.display = 'none';
        this.classList.add('active');
        document.getElementById("tabLead").classList.remove('active');
        document.getElementById("tabCostumer").classList.remove('active');
      });
      document.getElementById("tabLead").addEventListener('click', function(e){
        e.preventDefault();
        document.getElementById('inicioTab').style.display = 'none';
        document.getElementById('leadTab').style.display = '';
        document.getElementById('costumerTab').style.display = 'none';
        this.classList.add('active');
        document.getElementById("tabInicio").classList.remove('active');
        document.getElementById("tabCostumer").classList.remove('active');
      });
      document.getElementById("tabCostumer").addEventListener('click', function(e){
        e.preventDefault();
        document.getElementById('inicioTab').style.display = 'none';
        document.getElementById('leadTab').style.display = 'none';
        document.getElementById('costumerTab').style.display = '';
        this.classList.add('active');
        document.getElementById("tabInicio").classList.remove('active');
        document.getElementById("tabLead").classList.remove('active');
        fetchAndRenderLeads();
      });
    });

    // Cargar y mostrar leads en la tabla de Costumer
    async function fetchAndRenderLeads() {
      const debugPanel = document.getElementById('debug-panel');
      const debugStatus = document.getElementById('debug-status');
      const debugData = document.getElementById('debug-data');
      
      debugPanel.style.display = 'block';
      debugStatus.textContent = 'Estado: Realizando petición a /api/leads...';
      debugStatus.style.color = '#eab308'; // Amarillo
      debugData.textContent = 'Datos: N/A';

      const tbody = document.getElementById('costumer-tbody');
      tbody.innerHTML = `<tr><td colspan="18" style="text-align:center;padding:2em;"><i class="fas fa-spinner fa-spin"></i> Cargando...</td></tr>`;
      try {
        const response = await fetch('/api/leads', {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!response.ok) {
          const errorData = await response.text();
          debugStatus.textContent = 'Estado: Error en la respuesta del servidor (Código ' + response.status + ')';
          debugStatus.style.color = '#ef4444'; // Rojo
          debugData.textContent = 'Error: ' + errorData;
          throw new Error('No se pudo obtener la lista de leads. Respuesta del servidor: ' + response.status);
        }
        const leads = await response.json();

        debugStatus.textContent = 'Estado: Éxito. Datos recibidos.';
        debugStatus.style.color = '#22c55e'; // Verde
        debugData.textContent = JSON.stringify(leads, null, 2);

        tbody.innerHTML = ""; // Limpiar la tabla antes de renderizar
        if (leads.length === 0) {
          tbody.innerHTML = `<tr><td colspan="18" style="text-align:center;padding:2em;">No hay registros para mostrar.</td></tr>`;
          return;
        }

        console.log('[Costumer] Leads recibidos:', leads);
leads.forEach((venta, idx) => {
  const rowClass = idx % 2 === 0 ? 'costumer-row-striped' : '';
  // Preparar comentarios
  const comentarios = Array.isArray(venta.comentarios_venta) ? venta.comentarios_venta : [];
  const comentariosCount = comentarios.length;
  // Botón de comentarios con contador
  const comentariosBtn = `<button class="comentario-btn-minimal" title="Ver y gestionar comentarios" onclick="mostrarComentariosCostumer('${venta._id}')">
    <i class="fas fa-comment-dots"></i>${comentariosCount > 0 ? `<span class='comentarios-count'>${comentariosCount}</span>` : ''}
  </button>`;
  // Render fila en el orden correcto (según memoria)
  tbody.innerHTML += `
    <tr class="${rowClass}">
      <td>${venta.nombre_cliente || ''}</td>
      <td>${venta.telefono_principal || ''}</td>
      <td>${venta.telefono_alterno || ''}</td>
      <td>${venta.numero_cuenta || ''}</td>
      <td>${venta.autopago || ''}</td>
      <td>${venta.direccion || ''}</td>
      <td>${venta.tipo_servicios || ''}</td>
      <td>${venta.sistema || ''}</td>
      <td>${venta.riesgo || ''}</td>
      <td>${venta.dia_venta || ''}</td>
      <td>${venta.dia_instalacion || ''}</td>
      <td>${venta.status || ''}</td>
      <td>${venta.servicios || ''}</td>
      <td>${venta.mercado || ''}</td>
      <td>${venta.supervisor || ''}</td>
      <td>${venta.comentario || ''}</td>
      <td>${venta.motivo_llamada || ''}</td>
      <td>${venta.zip_code || ''}</td>
      <td>${venta.puntaje || 0}</td>
      <td style="text-align:center;">${comentariosBtn}</td>
      <td>
        <button class="acciones-btn-minimal borrar" onclick="borrarVenta('${venta._id}')" title="Borrar venta"><i class="fas fa-trash-alt"></i></button>
      </td>
    </tr>
  `;
  console.log(`[Costumer][Fila ${idx}]`, venta);
});
// Estilo para contador de comentarios
if (!document.getElementById('comentarios-count-style')) {
  const style = document.createElement('style');
  style.id = 'comentarios-count-style';
  style.innerHTML = `.comentarios-count { background: #1976d2; color: #fff; border-radius: 8px; padding: 1px 7px; font-size: 0.85em; margin-left: 4px; }`;
  document.head.appendChild(style);
}

      } catch (error) {
        // Actualizar panel de depuración en caso de error
        debugStatus.textContent = 'Estado: Error en la petición fetch.';
        debugStatus.style.color = '#ef4444'; // Rojo
        debugData.textContent = 'Error: ' + error.message;
        tbody.innerHTML = `<tr><td colspan="18" class="no-data-msg">Error al cargar los leads: ${error.message}</td></tr>`;
      }
    }

    // Guardar Lead
    document.getElementById('lead-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const boton = form.querySelector('button[type="submit"]');
      const originalText = boton.innerHTML;
      boton.disabled = true;
      boton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';

      const leadData = {
        nombre_cliente: form.nombre_cliente.value,
        telefono_principal: form.telefono_principal.value,
        telefono_alterno: form.telefono_alterno.value,
        numero_cuenta: form.numero_cuenta.value,
        autopago: form.autopago.value,
        direccion: form.direccion.value,
        tipo_servicios: form.tipo_servicios.value,
        sistema: form.sistema.value,
        riesgo: form.riesgo.value,
        dia_venta: form.dia_venta.value,
        dia_instalacion: form.dia_instalacion.value,
        status: form.status.value,
        servicios: form.servicios.value,
        mercado: form.mercado.value,
        supervisor: form.supervisor.value,
        comentario: form.comentario.value,
        motivo_llamada: form.motivo_llamada.value,
        zip_code: form.zip_code.value,
        creadoEn: new Date().toISOString()
      };

      try {
        const response = await fetch('/api/leads', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${localStorage.getItem('token')}`
          },
          body: JSON.stringify(leadData)
        });

        const result = await response.json();

        if (result.ok) {
          Swal.fire('¡Guardado!', 'El lead ha sido guardado correctamente.', 'success');
          form.reset();
          // Cambiamos a la pestaña de Costumer para ver el resultado
          document.getElementById('tabCostumer').click();
        } else {
          throw new Error(result.error || 'Error desconocido del servidor');
        }
      } catch (error) {
        Swal.fire('Error', `No se pudo guardar el lead: ${error.message}`, 'error');
      } finally {
        boton.disabled = false;
        boton.innerHTML = originalText;
      }
    });

    // CSS para filas striped y acciones minimalistas
    (function(){
      const style = document.createElement('style');
      style.innerHTML = `
        .costumer-row-striped { background: #f8fbff; }
        #costumer-tbody tr { transition: background 0.14s; }
        #costumer-tbody tr:hover { background: #e3f2fd !important; }
        .comentario-btn-minimal, .acciones-btn-minimal {
          background: none; border: none; color: #1976d2; font-size: 1.05em; padding: 5px 7px; border-radius: 7px;
          transition: background 0.18s, color 0.18s;
          margin-right: 3px;
          cursor: pointer;
        }
        .comentario-btn-minimal:hover, .acciones-btn-minimal:hover { background: #e3f2fd; color: #0d47a1; }
        .acciones-btn-minimal.borrar { color: #e53935; }
        .acciones-btn-minimal.borrar:hover { background: #ffebee; color: #b71c1c; }
        .comentario-tooltip-minimal { margin-left:5px; color:#1976d2; cursor:pointer; position:relative; }
        .comentario-tooltip-minimal:hover::after {
          content: attr(data-tooltip);
          white-space: pre-line;
          position: absolute;
          left: 50%;
          top: 120%;
          transform: translateX(-50%);
          background: #fff;
          color: #24334d;
          border: 1px solid #b4c5d4;
          border-radius: 7px;
          padding: 10px 17px;
          box-shadow: 0 4px 16px #1976d211;
          font-size: 0.98em;
          z-index: 20;
          min-width: 180px;
          max-width: 350px;
          pointer-events: none;
        }
      `;
      document.head.appendChild(style);
    })();
// --- Lógica para Lead Crm-Agente y Costumer ---
async function fetchLeadsAgente() {
  try {
    const res = await fetch('/api/leads', {
      headers: {'Authorization': 'Bearer ' + (localStorage.getItem('token')||'')}
    });
    const data = await res.json();
    if (!res.ok || !Array.isArray(data)) {
      // Si la API responde con error o no es array, muestra mensaje y retorna array vacío
      mostrarMensaje('Error obteniendo leads: ' + (data.message || res.statusText), 'error');
      return [];
    }
    return data;
  } catch (err) {
    mostrarMensaje('Error de red al obtener leads', 'error');
    return [];
  }
}

// Muestra mensajes de éxito o error en la UI
function mostrarMensaje(msg, tipo = 'info') {
  let div = document.getElementById('mensaje-global');
  if (!div) {
    div = document.createElement('div');
    div.id = 'mensaje-global';
    div.style.position = 'fixed';
    div.style.top = '18px';
    div.style.right = '18px';
    div.style.zIndex = '9999';
    div.style.padding = '1em 2em';
    div.style.borderRadius = '9px';
    div.style.fontWeight = 'bold';
    div.style.fontSize = '1.1em';
    div.style.boxShadow = '0 2px 8px #0002';
    div.style.transition = 'opacity 0.3s';
    document.body.appendChild(div);
  }
  div.innerText = msg;
  div.style.background = tipo === 'error' ? '#ffebee' : '#e3f9e5';
  div.style.color = tipo === 'error' ? '#b71c1c' : '#1976d2';
  div.style.opacity = 1;
  setTimeout(()=>{ div.style.opacity = 0; }, 3500);
}


function renderTablaLeadAgente(leads) {
  if (!leads.length) {
    document.getElementById('theadLeadAgente').innerHTML = '<tr><th>No hay leads almacenados</th></tr>';
    document.getElementById('tbodyLeadAgente').innerHTML = '';
    return;
  }
  // Obtener todos los encabezados únicos
  const headers = Object.keys(leads.reduce((a, c) => Object.assign(a, c), {}));
  document.getElementById('theadLeadAgente').innerHTML = '<tr>' + headers.map(h => `<th>${h}</th>`).join('') + '</tr>';
  document.getElementById('tbodyLeadAgente').innerHTML = leads.map(lead =>
    '<tr>' + headers.map(h => `<td>${lead[h] ?? ''}</td>`).join('') + '</tr>'
  ).join('');
}

/**
 * Renderiza la tabla de clientes con un formato profesional y funcional
 * @param {Array} leads - Lista de clientes/leads a mostrar
 */
function renderCostumerTable(leads) {
  const tbody = document.getElementById('costumer-tbody');
  if (!tbody) {
    console.error('No se encontró el elemento con ID "costumer-tbody"');
    return;
  }

  // Limpiar la tabla antes de agregar nuevos elementos
  tbody.innerHTML = '';

  if (!Array.isArray(leads) || !leads.length) {
    tbody.innerHTML = `
      <tr>
        <td colspan="21" style="text-align: center; padding: 20px; color: #666; font-style: italic;">
          No hay clientes para mostrar
        </td>
      </tr>`;
    return;
  }

  // Ordenar por fecha de creación (más recientes primero)
  const sortedLeads = [...leads].sort((a, b) => 
    new Date(b.creadoEn || b.fecha || 0) - new Date(a.creadoEn || a.fecha || 0)
  );

  // Procesar y renderizar cada lead
  sortedLeads.forEach(lead => {
    const row = document.createElement('tr');
    
    // Función auxiliar para formatear el texto y evitar undefined/null
    const formatText = (text) => (text || '').toString().trim() || '-';
    
    // Función para crear un badge de estado
    const createStatusBadge = (status) => {
      status = (status || '').toLowerCase();
      let badgeClass = 'badge-status';
      
      if (status.includes('activo') || status.includes('completado')) {
        badgeClass += ' badge-status-activo';
      } else if (status.includes('pendiente') || status.includes('proceso')) {
        badgeClass += ' badge-status-pendiente';
      } else if (status.includes('cancelado') || status.includes('rechazado')) {
        badgeClass += ' badge-status-cancelado';
      } else if (status.includes('inactivo')) {
        badgeClass += ' badge-status-inactivo';
      }
      
      return `<span class="${badgeClass}">${formatText(status).toUpperCase()}</span>`;
    };

    // Función para crear un botón de acción con ícono
    const createActionButton = (icon, title, onClick, extraClass = '') => {
      return `<button class="action-btn ${extraClass}" title="${title}" onclick="${onClick}">
                <i class="fas ${icon}"></i>
              </button>`;
    };

    // Construir las celdas en el orden correcto según los encabezados
    row.innerHTML = `
      <td>${formatText(lead.nombre_cliente)}</td>
      <td>${formatText(lead.telefono_principal)}</td>
      <td>${formatText(lead.telefono_alterno)}</td>
      <td>${formatText(lead.numero_cuenta)}</td>
      <td>${formatText(lead.autopago)}</td>
      <td title="${formatText(lead.direccion)}" class="truncate-text">${formatText(lead.direccion).substring(0, 20)}${lead.direccion && lead.direccion.length > 20 ? '...' : ''}</td>
      <td>${formatText(lead.tipo_servicios)}</td>
      <td>${formatText(lead.sistema)}</td>
      <td>${formatText(lead.riesgo)}</td>
      <td>${formatText(lead.dia_venta)}</td>
      <td>${formatText(lead.dia_instalacion)}</td>
      <td>${createStatusBadge(lead.status)}</td>
      <td>${formatText(lead.servicios)}</td>
      <td>${formatText(lead.mercado)}</td>
      <td>${formatText(lead.supervisor)}</td>
      <td title="${formatText(lead.comentario)}" class="truncate-text comentario-tooltip" data-tooltip="${formatText(lead.comentario)}">
        ${formatText(lead.comentario).substring(0, 15)}${lead.comentario && lead.comentario.length > 15 ? '...' : ''}
      </td>
      <td>${formatText(lead.motivo_llamada)}</td>
      <td>${formatText(lead.zip_code)}</td>
      <td>${formatText(lead.puntaje)}</td>
      <td class="comentarios-cell" style="text-align: center;">
        <button class="comentarios-btn ${lead.comentarios_venta?.length ? 'has-comments' : ''}" 
                onclick="mostrarComentariosCostumer('${lead._id || ''}', event)"
                title="${lead.comentarios_venta?.length ? 'Ver y gestionar comentarios' : 'Agregar comentario'}"
                data-comments-count="${lead.comentarios_venta?.length || '0'}">
          <i class="fas ${lead.comentarios_venta?.length ? 'fa-comments' : 'fa-comment'}"></i>
          <span class="comment-count">${lead.comentarios_venta?.length || '0'}</span>
        </button>
      </td>
      <td class="actions-cell">
        ${createActionButton('fa-edit', 'Editar', `editarLead('${lead._id || ''}')`, 'edit-btn')}
        ${createActionButton('fa-trash-alt', 'Eliminar', `eliminarLead('${lead._id || ''}')`, 'delete-btn')}
      </td>
    `;

    tbody.appendChild(row);
  });
  
  // Actualizar contadores en las tarjetas resumen
  updateSummaryCards(leads);
}

/**
 * Actualiza las tarjetas de resumen con información de los leads
 * @param {Array} leads - Lista de clientes/leads
 */
function updateSummaryCards(leads) {
  if (!leads || !leads.length) return;
  
  const hoy = new Date().toISOString().split('T')[0];
  const mesActual = new Date().getMonth();
  const añoActual = new Date().getFullYear();
  
  // Función auxiliar para normalizar el texto (sin acentos y en minúsculas)
  const normalizarTexto = (texto) => {
    return (texto || '')
      .toString()
      .toLowerCase()
      .normalize('NFD').replace(/[\u0300-\u036f]/g, ''); // Eliminar acentos
  };
  
  // Contar ventas de hoy (fecha actual)
  const ventasHoy = leads.filter(lead => {
    try {
      const fechaLead = new Date(lead.creadoEn || lead.fecha || 0);
      if (isNaN(fechaLead.getTime())) return false; // Fecha inválida
      return fechaLead.toISOString().split('T')[0] === hoy;
    } catch (e) {
      console.error('Error al procesar fecha del lead:', e);
      return false;
    }
  }).length;
  
  // Contar clientes pendientes (PENDING o PENDIENTE)
  const pendientes = leads.filter(lead => {
    const status = normalizarTexto(lead.status);
    return status === 'pending' || status === 'pendiente';
  }).length;
  
  // Contar ventas canceladas (CANCELED, CANCELADAS o CANCELLED)
  const canceladas = leads.filter(lead => {
    const status = normalizarTexto(lead.status);
    return status.includes('cancel') || status.includes('cancelad');
  }).length;
  
  // Contar ventas del mes actual
  const ventasMes = leads.filter(lead => {
    try {
      const fechaLead = new Date(lead.creadoEn || lead.fecha || 0);
      if (isNaN(fechaLead.getTime())) return false; // Fecha inválida
      return fechaLead.getMonth() === mesActual && 
             fechaLead.getFullYear() === añoActual;
    } catch (e) {
      console.error('Error al procesar fecha del lead:', e);
      return false;
    }
  }).length;
  
  // Actualizar los contadores en la UI
  const ventasHoyEl = document.getElementById('costumer-ventas-hoy');
  const pendientesEl = document.getElementById('costumer-clientes-pendientes');
  const canceladasEl = document.getElementById('costumer-ventas-canceladas');
  const ventasMesEl = document.getElementById('costumer-ventas-mes');
  
  if (ventasHoyEl) ventasHoyEl.textContent = ventasHoy;
  if (pendientesEl) pendientesEl.textContent = pendientes;
  if (canceladasEl) canceladasEl.textContent = canceladas;
  if (ventasMesEl) ventasMesEl.textContent = ventasMes;
}

// Función auxiliar para mostrar comentarios (ya existente en costumer-comments.js)
window.mostrarComentariosCostumer = window.mostrarComentariosCostumer || function(id) {
  console.log('Mostrar comentarios para:', id);
  // Implementación básica si no existe
  alert(`Mostrando comentarios para el cliente con ID: ${id}`);
};

// Funciones de acción (deben ser implementadas)
function editarLead(id) {
  console.log('Editar lead:', id);
  // Implementar lógica de edición
}

function eliminarLead(id) {
  if (confirm('¿Estás seguro de que deseas eliminar este lead?')) {
    console.log('Eliminar lead:', id);
    // Implementar lógica de eliminación
  }
}



// --- Cambio de pestañas y renderizado ---
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', async e => {
    e.preventDefault();
    document.querySelectorAll('.dashboard-flex-row').forEach(s=>s.style.display='none');
    const tab = btn.dataset.tab;
    document.getElementById(tab).style.display = 'flex';
    if(tab==='leadAgenteTab') {
      const leads = await fetchLeadsAgente();
      if(Array.isArray(leads))
        renderTablaLeadAgente(leads.sort((a,b)=>(b.creadoEn||b.fecha||'').localeCompare(a.creadoEn||a.fecha||'')));
      else
        mostrarMensaje('No se pudo cargar leads', 'error');
    }
    if(tab==='costumerTab') {
      const leads = await fetchLeadsAgente();
      if(Array.isArray(leads)) {
        const sortedLeads = leads.sort((a,b)=>(b.creadoEn||b.fecha||'').localeCompare(a.creadoEn||a.fecha||''));
        renderCostumerTable(sortedLeads);
        updateSummaryCards(sortedLeads); // Actualizar los recuadros de resumen
      } else {
        mostrarMensaje('No se pudo cargar leads', 'error');
      }
    }
    if(tab==='charts-panel' || tab==='chartsTab') {
      // Llama a la gráfica cuando se cambia a la pestaña de gráficas
      if (typeof renderGraficas === 'function') renderGraficas();
    }
  });
});
// Al guardar un lead, refrescar ambas pestañas si están abiertas
window.refrescarLeadsAgente = async function() {
  const leads = await fetchLeadsAgente();
  if(Array.isArray(leads)) {
    const sortedLeads = leads.sort((a,b)=>(b.creadoEn||b.fecha||'').localeCompare(a.creadoEn||a.fecha||''));
    
    if(document.getElementById('leadAgenteTab').style.display!=='none')
      renderTablaLeadAgente(sortedLeads);
      
    if(document.getElementById('costumerTab').style.display!=='none') {
      renderCostumerTable(sortedLeads);
      updateSummaryCards(sortedLeads); // Actualizar los recuadros de resumen
    }
  } else {
    mostrarMensaje('No se pudo refrescar leads', 'error');
  }
}
// Llamar refresco inicial en costumer
window.addEventListener('DOMContentLoaded', async () => {
  // Refresca la tabla Costumer
  const leads = await fetchLeadsAgente();
  if(Array.isArray(leads)) {
    const sortedLeads = leads.sort((a,b)=>(b.creadoEn||b.fecha||'').localeCompare(a.creadoEn||a.fecha||''));
    renderCostumerTable(sortedLeads);
    updateSummaryCards(sortedLeads); // Actualizar los recuadros de resumen
  } else {
    mostrarMensaje('No se pudo cargar clientes', 'error');
  }
  // Renderiza la gráfica principal
  if (typeof renderGraficas === 'function') renderGraficas();
});
</script>
   <script src="js/core/auth-check.js"></script>
   <script src="js/core/login.js"></script>
   <script src="js/core/script.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
   <script src="js/core/graficas.js"></script>
   <script src="js/core/costumer-comments.js"></script>
</body>
 </html>